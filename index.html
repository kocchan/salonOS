<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SalonOS - ç¾å®¹å®¤ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </title>
<style>
  /* ===== RESET & BASE ===== */
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  :root {
    --primary: #f43f5e;
    --primary-light: #e11d48;
    --primary-pale: #fff1f2;
    --accent: #d4af37;
    --accent-light: #fdf8e7;
    --success: #22c55e;
    --success-light: #f0fdf4;
    --warning: #eab308;
    --warning-light: #fefce8;
    --danger: #f43f5e;
    --danger-light: #fff1f2;
    --text-primary: #1f2937;
    --text-secondary: #6b7280;
    --text-muted: #9ca3af;
    --border: #e5e7eb;
    --bg: #f9fafb;
    --white: #FFFFFF;
    --sidebar-w: 240px;
    --shadow-sm: 0 1px 3px 0 rgba(0,0,0,.08), 0 1px 2px -1px rgba(0,0,0,.06);
    --shadow-md: 0 4px 12px rgba(0,0,0,.1);
    --shadow-lg: 0 8px 24px -4px rgba(0,0,0,.14);
    --radius: 12px;
    --radius-sm: 8px;
    --radius-lg: 16px;
  }
  body {
    font-family: 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', 'Noto Sans JP', sans-serif;
    background: var(--bg);
    color: var(--text-primary);
    display: flex;
    min-height: 100vh;
    font-size: 14px;
    line-height: 1.5;
  }

  /* ===== SIDEBAR ===== */
  .sidebar {
    width: var(--sidebar-w);
    background: var(--white);
    border-right: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    position: fixed;
    top: 0; left: 0; bottom: 0;
    z-index: 100;
    box-shadow: 2px 0 8px rgba(124,92,191,.06);
  }
  .sidebar-logo {
    padding: 20px 20px 16px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .logo-icon {
    width: 36px; height: 36px;
    background: linear-gradient(135deg, var(--primary), var(--accent));
    border-radius: 10px;
    display: flex; align-items: center; justify-content: center;
    font-size: 18px;
  }
  .logo-text { font-weight: 700; font-size: 16px; color: var(--primary); }
  .logo-sub { font-size: 10px; color: var(--text-muted); }
  .sidebar-nav { padding: 12px 0; flex: 1; }
  .nav-item {
    display: flex; align-items: center; gap: 10px;
    padding: 10px 20px;
    cursor: pointer;
    border-radius: 0;
    color: var(--text-secondary);
    font-size: 13px;
    font-weight: 500;
    transition: all .15s;
    border-left: 3px solid transparent;
    text-decoration: none;
  }
  .nav-item:hover { background: var(--primary-pale); color: var(--primary); }
  .nav-item.active {
    background: var(--primary-pale);
    color: var(--primary);
    border-left-color: var(--primary);
    font-weight: 600;
  }
  .nav-icon { font-size: 16px; width: 20px; text-align: center; }
  .sidebar-footer {
    padding: 16px 20px;
    border-top: 1px solid var(--border);
  }
  .staff-badge {
    display: flex; align-items: center; gap: 10px;
    padding: 8px 12px;
    background: var(--primary-pale);
    border-radius: var(--radius-sm);
  }
  .staff-avatar {
    width: 32px; height: 32px;
    background: linear-gradient(135deg, var(--primary), var(--primary-light));
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    color: white; font-weight: 700; font-size: 12px;
  }
  .staff-name { font-size: 12px; font-weight: 600; color: var(--primary); }
  .staff-role { font-size: 10px; color: var(--text-muted); }

  /* ===== MAIN CONTENT ===== */
  .main {
    margin-left: var(--sidebar-w);
    flex: 1;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
  }
  .topbar {
    background: var(--white);
    border-bottom: 1px solid var(--border);
    padding: 0 28px;
    height: 56px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    position: sticky; top: 0; z-index: 90;
    box-shadow: var(--shadow-sm);
  }
  .topbar-title { font-size: 17px; font-weight: 700; }
  .topbar-actions { display: flex; align-items: center; gap: 12px; }
  .topbar-date { font-size: 12px; color: var(--text-muted); }

  .content { padding: 24px 28px; flex: 1; }

  /* Screen visibility */
  .screen { display: none; }
  .screen.active { display: block; }

  /* ===== BUTTONS ===== */
  .btn {
    display: inline-flex; align-items: center; gap: 6px;
    padding: 8px 16px;
    border-radius: var(--radius-sm);
    font-size: 13px; font-weight: 600;
    cursor: pointer;
    border: none;
    transition: all .15s;
    font-family: inherit;
    white-space: nowrap;
  }
  .btn-primary {
    background: var(--primary);
    color: white;
  }
  .btn-primary:hover { background: var(--primary-light); transform: translateY(-1px); box-shadow: 0 4px 12px rgba(124,92,191,.3); }
  .btn-secondary {
    background: var(--white);
    color: var(--text-secondary);
    border: 1px solid var(--border);
  }
  .btn-secondary:hover { background: var(--bg); }
  .btn-success { background: var(--success); color: white; }
  .btn-success:hover { background: #3D9A74; }
  .btn-danger { background: var(--danger); color: white; }
  .btn-sm { padding: 5px 10px; font-size: 12px; }
  .btn-line {
    background: #00C300;
    color: white;
  }
  .btn-line:hover { background: #00A800; }

  /* ===== CARDS ===== */
  .card {
    background: var(--white);
    border-radius: var(--radius);
    padding: 20px;
    box-shadow: var(--shadow-sm);
    border: 1px solid var(--border);
  }
  .card-header {
    display: flex; align-items: center; justify-content: space-between;
    margin-bottom: 16px;
  }
  .card-title {
    font-size: 14px; font-weight: 700;
    display: flex; align-items: center; gap: 8px;
  }

  /* ===== KPI CARDS ===== */
  .kpi-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 16px;
    margin-bottom: 24px;
  }
  .kpi-card {
    background: var(--white);
    border-radius: var(--radius);
    padding: 20px;
    box-shadow: var(--shadow-sm);
    border: 1px solid var(--border);
    position: relative;
    overflow: hidden;
  }
  .kpi-card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 3px;
  }
  .kpi-card.purple::before { background: var(--primary); }
  .kpi-card.green::before { background: var(--success); }
  .kpi-card.orange::before { background: var(--warning); }
  .kpi-card.pink::before { background: var(--accent); }
  .kpi-label { font-size: 11px; color: var(--text-muted); font-weight: 600; text-transform: uppercase; letter-spacing: .5px; margin-bottom: 8px; }
  .kpi-value { font-size: 28px; font-weight: 800; color: var(--text-primary); line-height: 1; }
  .kpi-unit { font-size: 13px; font-weight: 500; margin-left: 2px; }
  .kpi-change {
    margin-top: 8px;
    font-size: 11px;
    display: flex; align-items: center; gap: 4px;
  }
  .kpi-change.up { color: var(--success); }
  .kpi-change.down { color: var(--danger); }
  .kpi-icon {
    position: absolute;
    top: 16px; right: 16px;
    font-size: 24px;
    opacity: .15;
  }

  /* ===== SECTION HEADERS ===== */
  .section-header {
    display: flex; align-items: center; justify-content: space-between;
    margin-bottom: 14px;
  }
  .section-title {
    font-size: 14px; font-weight: 700;
    display: flex; align-items: center; gap: 8px;
  }
  .badge {
    display: inline-flex; align-items: center; justify-content: center;
    padding: 2px 8px;
    border-radius: 20px;
    font-size: 11px; font-weight: 700;
  }
  .badge-danger { background: var(--danger-light); color: var(--danger); }
  .badge-warning { background: var(--warning-light); color: var(--warning); }
  .badge-success { background: var(--success-light); color: var(--success); }
  .badge-primary { background: var(--primary-pale); color: var(--primary); }
  .badge-muted { background: var(--bg); color: var(--text-muted); }

  /* ===== DASHBOARD LAYOUT ===== */
  .dashboard-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
  }
  .dashboard-grid .full-width { grid-column: 1 / -1; }

  /* Today's appointments list */
  .appt-list { display: flex; flex-direction: column; gap: 8px; }
  .appt-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 10px 14px;
    border-radius: var(--radius-sm);
    border: 1px solid var(--border);
    background: var(--white);
    cursor: pointer;
    transition: all .15s;
  }
  .appt-item:hover { border-color: var(--primary-light); background: var(--primary-pale); }
  .appt-time {
    font-size: 12px; font-weight: 700;
    color: var(--primary);
    min-width: 50px;
    text-align: center;
  }
  .appt-bar {
    width: 3px; height: 36px;
    border-radius: 2px;
    flex-shrink: 0;
  }
  .bar-confirmed { background: var(--success); }
  .bar-tentative { background: var(--warning); }
  .bar-cancelled { background: var(--text-muted); }
  .appt-info { flex: 1; }
  .appt-name { font-size: 13px; font-weight: 600; }
  .appt-menu { font-size: 11px; color: var(--text-muted); }
  .appt-price {
    font-size: 13px; font-weight: 700;
    color: var(--text-secondary);
  }
  .status-dot {
    width: 7px; height: 7px;
    border-radius: 50%;
    flex-shrink: 0;
  }
  .dot-confirmed { background: var(--success); }
  .dot-tentative { background: var(--warning); }
  .dot-cancelled { background: var(--text-muted); }

  /* Alert list */
  .alert-list { display: flex; flex-direction: column; gap: 8px; }
  .alert-item {
    display: flex; align-items: center; gap: 10px;
    padding: 10px 14px;
    background: var(--danger-light);
    border-radius: var(--radius-sm);
    border-left: 3px solid var(--danger);
  }
  .alert-item .name { font-size: 13px; font-weight: 600; flex: 1; }
  .alert-item .days { font-size: 11px; color: var(--danger); font-weight: 600; }

  /* Recent karte */
  .karte-mini-list { display: flex; flex-direction: column; gap: 8px; }
  .karte-mini {
    display: flex; align-items: center; gap: 10px;
    padding: 10px 14px;
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    cursor: pointer;
    transition: all .15s;
  }
  .karte-mini:hover { border-color: var(--primary); background: var(--primary-pale); }
  .avatar {
    width: 36px; height: 36px;
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-weight: 700; font-size: 13px;
    flex-shrink: 0;
    color: white;
  }
  .karte-mini .info { flex: 1; }
  .karte-mini .info .name { font-size: 13px; font-weight: 600; }
  .karte-mini .info .sub { font-size: 11px; color: var(--text-muted); }
  .karte-mini .meta { text-align: right; }
  .karte-mini .meta .date { font-size: 11px; color: var(--text-muted); }

  /* ===== APPOINTMENTS CALENDAR ===== */
  .calendar-nav {
    display: flex; align-items: center; gap: 12px;
    margin-bottom: 16px;
  }
  .calendar-nav h2 { font-size: 16px; font-weight: 700; flex: 1; }
  .week-grid {
    display: grid;
    grid-template-columns: 60px repeat(7, 1fr);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    overflow: hidden;
    background: var(--white);
    box-shadow: var(--shadow-sm);
  }
  .week-header {
    display: contents;
  }
  .week-header-cell {
    padding: 10px 6px;
    text-align: center;
    background: var(--primary-pale);
    border-bottom: 2px solid var(--primary);
    font-size: 12px; font-weight: 700;
  }
  .week-header-cell .dow { color: var(--text-muted); font-weight: 500; font-size: 10px; }
  .week-header-cell .dom { font-size: 16px; color: var(--primary); }
  .week-header-cell.today .dom {
    background: var(--primary);
    color: white;
    width: 28px; height: 28px;
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    margin: 0 auto;
  }
  .time-col-header {
    background: var(--primary-pale);
    border-bottom: 2px solid var(--primary);
    border-right: 1px solid var(--border);
  }
  .time-slot-row {
    display: contents;
  }
  .time-label {
    padding: 0 8px;
    text-align: right;
    font-size: 10px; color: var(--text-muted);
    border-right: 1px solid var(--border);
    height: 48px;
    display: flex; align-items: flex-start;
    padding-top: 4px;
  }
  .time-cell {
    border-right: 1px solid var(--border);
    border-bottom: 1px solid #F3F4F6;
    height: 48px;
    position: relative;
    cursor: pointer;
  }
  .time-cell:hover { background: #FAFAFA; }
  .time-cell:last-child { border-right: none; }
  .cal-event {
    position: absolute;
    left: 2px; right: 2px;
    border-radius: 5px;
    padding: 3px 5px;
    font-size: 10px;
    cursor: pointer;
    overflow: hidden;
    z-index: 10;
    line-height: 1.3;
    box-shadow: 0 1px 3px rgba(0,0,0,.15);
    transition: all .15s;
  }
  .cal-event:hover { z-index: 20; transform: scale(1.02); box-shadow: var(--shadow-md); }
  .cal-event.confirmed { background: var(--success-light); border-left: 3px solid var(--success); color: #2D7A5A; }
  .cal-event.tentative { background: var(--warning-light); border-left: 3px solid var(--warning); color: #8A5E00; }
  .cal-event.cancelled { background: #F3F4F6; border-left: 3px solid var(--text-muted); color: var(--text-muted); text-decoration: line-through; }
  .cal-event .ev-name { font-weight: 700; }
  .cal-event .ev-menu { font-size: 9px; }

  /* ===== CUSTOMER GRID ===== */
  .search-bar {
    display: flex; align-items: center; gap: 10px;
    margin-bottom: 20px;
  }
  .search-input {
    flex: 1;
    padding: 10px 14px 10px 38px;
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    font-size: 13px;
    background: var(--white) url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='14' viewBox='0 0 24 24' fill='none' stroke='%239CA3AF' stroke-width='2'%3E%3Ccircle cx='11' cy='11' r='8'/%3E%3Cpath d='m21 21-4.35-4.35'/%3E%3C/svg%3E") no-repeat 12px center;
    font-family: inherit;
    outline: none;
    transition: border-color .15s;
  }
  .search-input:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(124,92,191,.1); }
  .customer-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
    gap: 16px;
  }
  .customer-card {
    background: var(--white);
    border-radius: var(--radius);
    padding: 18px;
    box-shadow: var(--shadow-sm);
    border: 1px solid var(--border);
    cursor: pointer;
    transition: all .2s;
    position: relative;
  }
  .customer-card:hover {
    border-color: var(--primary-light);
    box-shadow: var(--shadow-md);
    transform: translateY(-2px);
  }
  .customer-card-header {
    display: flex; align-items: center; gap: 12px;
    margin-bottom: 12px;
  }
  .customer-card .name { font-size: 15px; font-weight: 700; }
  .customer-card .furigana { font-size: 10px; color: var(--text-muted); }
  .customer-card .last-visit { font-size: 12px; color: var(--text-secondary); margin-bottom: 4px; }
  .customer-card .visit-count {
    font-size: 11px; color: var(--text-muted);
    display: flex; align-items: center; gap: 4px;
  }
  .service-icons {
    display: flex; gap: 4px;
    margin-top: 10px;
    flex-wrap: wrap;
  }
  .service-tag {
    font-size: 10px;
    padding: 2px 8px;
    border-radius: 20px;
    background: var(--primary-pale);
    color: var(--primary);
    font-weight: 600;
  }
  .overdue-badge {
    position: absolute;
    top: 12px; right: 12px;
    background: var(--danger);
    color: white;
    font-size: 9px;
    font-weight: 700;
    padding: 2px 7px;
    border-radius: 20px;
  }
  .line-badge {
    display: inline-flex; align-items: center; gap: 3px;
    font-size: 10px;
    padding: 2px 7px;
    border-radius: 20px;
    background: #E8F8E8;
    color: #00A800;
    font-weight: 700;
  }

  /* ===== CUSTOMER DETAIL ===== */
  .detail-layout {
    display: grid;
    grid-template-columns: 300px 1fr;
    gap: 20px;
  }
  .profile-card {
    background: var(--white);
    border-radius: var(--radius);
    padding: 24px;
    box-shadow: var(--shadow-sm);
    border: 1px solid var(--border);
    height: fit-content;
  }
  .profile-avatar-lg {
    width: 72px; height: 72px;
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-weight: 800; font-size: 26px;
    color: white;
    margin: 0 auto 16px;
  }
  .profile-name { text-align: center; font-size: 18px; font-weight: 800; margin-bottom: 4px; }
  .profile-furigana { text-align: center; font-size: 11px; color: var(--text-muted); margin-bottom: 16px; }
  .profile-actions { display: flex; gap: 8px; margin-bottom: 20px; }
  .profile-actions .btn { flex: 1; justify-content: center; }
  .profile-info-table { width: 100%; border-collapse: collapse; }
  .profile-info-table tr { border-bottom: 1px solid var(--border); }
  .profile-info-table tr:last-child { border-bottom: none; }
  .profile-info-table th {
    font-size: 11px; color: var(--text-muted); font-weight: 600;
    text-align: left; padding: 9px 0;
    width: 80px;
  }
  .profile-info-table td { font-size: 13px; padding: 9px 0; font-weight: 500; }
  .next-visit-box {
    margin-top: 16px;
    padding: 12px;
    background: var(--primary-pale);
    border-radius: var(--radius-sm);
    border: 1px dashed var(--primary-light);
    text-align: center;
  }
  .next-visit-box .label { font-size: 10px; color: var(--primary); font-weight: 600; text-transform: uppercase; margin-bottom: 4px; }
  .next-visit-box .date { font-size: 16px; font-weight: 800; color: var(--primary); }
  .next-visit-box .sub { font-size: 10px; color: var(--text-muted); }

  /* Timeline */
  .timeline { position: relative; padding-left: 20px; }
  .timeline::before {
    content: '';
    position: absolute;
    left: 7px; top: 0; bottom: 0;
    width: 2px;
    background: var(--border);
  }
  .timeline-item {
    position: relative;
    margin-bottom: 20px;
  }
  .timeline-item::before {
    content: '';
    position: absolute;
    left: -16px; top: 16px;
    width: 10px; height: 10px;
    border-radius: 50%;
    background: var(--primary);
    border: 2px solid white;
    box-shadow: 0 0 0 2px var(--primary);
  }
  .timeline-card {
    background: var(--white);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 16px;
    box-shadow: var(--shadow-sm);
  }
  .tl-header {
    display: flex; align-items: center; justify-content: space-between;
    margin-bottom: 10px;
  }
  .tl-date { font-size: 12px; color: var(--text-muted); font-weight: 600; }
  .tl-price { font-size: 15px; font-weight: 800; color: var(--primary); }
  .tl-menu { font-size: 14px; font-weight: 700; margin-bottom: 8px; }
  .tl-formula {
    font-size: 12px; color: var(--text-secondary);
    background: var(--bg);
    padding: 8px 10px;
    border-radius: 6px;
    margin-bottom: 8px;
    font-family: monospace;
    line-height: 1.6;
  }
  .tl-footer {
    display: flex; align-items: center; gap: 8px;
    font-size: 11px; color: var(--text-muted);
  }

  /* ===== LINE SENDER ===== */
  .line-layout {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
  }
  .line-customer-list { display: flex; flex-direction: column; gap: 8px; }
  .line-customer-item {
    display: flex; align-items: center; gap: 10px;
    padding: 12px 14px;
    background: var(--white);
    border: 2px solid var(--border);
    border-radius: var(--radius-sm);
    cursor: pointer;
    transition: all .15s;
  }
  .line-customer-item:hover { border-color: #00C300; background: #F0FBF0; }
  .line-customer-item.selected { border-color: #00C300; background: #E8F8E8; }
  .line-customer-item .info { flex: 1; }
  .line-customer-item .name { font-size: 13px; font-weight: 700; }
  .line-customer-item .sub { font-size: 11px; color: var(--text-muted); }
  .line-preview-box {
    background: var(--white);
    border-radius: var(--radius);
    padding: 20px;
    box-shadow: var(--shadow-sm);
    border: 1px solid var(--border);
  }
  .line-phone-mock {
    background: #1A1A2E;
    border-radius: 20px;
    padding: 16px;
    max-width: 320px;
    margin: 0 auto;
  }
  .line-phone-header {
    text-align: center;
    color: white;
    font-size: 11px;
    margin-bottom: 12px;
    opacity: .6;
  }
  .line-chat-bubble {
    background: white;
    border-radius: 0 12px 12px 12px;
    padding: 12px 14px;
    font-size: 13px;
    line-height: 1.7;
    color: var(--text-primary);
    box-shadow: 0 2px 6px rgba(0,0,0,.2);
    max-width: 90%;
  }
  .line-sender-name {
    color: #00C300;
    font-size: 11px;
    font-weight: 700;
    margin-bottom: 6px;
  }
  .send-btn-wrap { margin-top: 16px; text-align: center; }
  .send-btn-wrap .btn { padding: 12px 32px; font-size: 15px; width: 100%; justify-content: center; }

  /* Send animation */
  .send-success {
    display: none;
    flex-direction: column; align-items: center;
    gap: 8px;
    padding: 20px;
    text-align: center;
  }
  .send-success.show { display: flex; }
  .send-success .checkmark { font-size: 48px; animation: pop .3s ease; }
  @keyframes pop {
    0% { transform: scale(0); }
    80% { transform: scale(1.2); }
    100% { transform: scale(1); }
  }
  .send-success .msg { font-size: 14px; font-weight: 700; color: var(--success); }

  /* History table */
  .history-table { width: 100%; border-collapse: collapse; margin-top: 16px; }
  .history-table th {
    font-size: 11px; color: var(--text-muted);
    text-align: left; padding: 8px 12px;
    background: var(--bg);
    border-bottom: 1px solid var(--border);
    font-weight: 600;
  }
  .history-table td {
    padding: 10px 12px;
    border-bottom: 1px solid var(--border);
    font-size: 12px;
  }
  .history-table tr:last-child td { border-bottom: none; }
  .history-table tr:hover td { background: var(--bg); }
  .status-pill {
    display: inline-flex; align-items: center;
    padding: 2px 8px;
    border-radius: 20px;
    font-size: 10px; font-weight: 700;
  }
  .pill-delivered { background: var(--success-light); color: var(--success); }
  .pill-failed { background: var(--danger-light); color: var(--danger); }
  .pill-pending { background: var(--warning-light); color: var(--warning); }

  /* ===== MODAL ===== */
  .modal-overlay {
    display: none;
    position: fixed; inset: 0;
    background: rgba(0,0,0,.45);
    z-index: 200;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(2px);
  }
  .modal-overlay.open { display: flex; }
  .modal {
    background: var(--white);
    border-radius: var(--radius-lg);
    padding: 28px;
    width: 480px;
    max-width: 95vw;
    box-shadow: var(--shadow-lg);
    animation: slideUp .2s ease;
  }
  @keyframes slideUp {
    from { transform: translateY(20px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
  }
  .modal-header {
    display: flex; align-items: center; justify-content: space-between;
    margin-bottom: 20px;
  }
  .modal-title { font-size: 16px; font-weight: 800; }
  .modal-close {
    width: 28px; height: 28px;
    display: flex; align-items: center; justify-content: center;
    border-radius: 50%;
    cursor: pointer;
    color: var(--text-muted);
    font-size: 18px;
    background: none; border: none;
    transition: background .15s;
  }
  .modal-close:hover { background: var(--bg); color: var(--text-primary); }
  .form-group { margin-bottom: 14px; }
  .form-label { font-size: 12px; font-weight: 600; color: var(--text-secondary); margin-bottom: 5px; display: block; }
  .form-control {
    width: 100%;
    padding: 9px 12px;
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    font-size: 13px;
    font-family: inherit;
    outline: none;
    transition: border-color .15s;
    background: var(--white);
  }
  .form-control:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(124,92,191,.1); }
  .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
  .modal-footer { display: flex; gap: 8px; justify-content: flex-end; margin-top: 20px; }

  /* ===== SCROLLBAR ===== */
  ::-webkit-scrollbar { width: 6px; height: 6px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
  ::-webkit-scrollbar-thumb:hover { background: var(--text-muted); }

  /* ===== EMPTY STATE ===== */
  .empty-state {
    text-align: center;
    padding: 40px 20px;
    color: var(--text-muted);
  }
  .empty-state .icon { font-size: 36px; margin-bottom: 10px; }
  .empty-state p { font-size: 13px; }

  /* ===== TOOLTIP ===== */
  .tooltip-wrap { position: relative; display: inline-block; }
  .tooltip-wrap:hover .tooltip { opacity: 1; }
  .tooltip {
    opacity: 0;
    position: absolute;
    bottom: calc(100% + 5px);
    left: 50%;
    transform: translateX(-50%);
    background: var(--text-primary);
    color: white;
    font-size: 11px;
    padding: 4px 8px;
    border-radius: 5px;
    white-space: nowrap;
    pointer-events: none;
    transition: opacity .15s;
    z-index: 999;
  }

  /* ===== RESPONSIVE ===== */
  @media (max-width: 1100px) {
    .kpi-grid { grid-template-columns: repeat(2, 1fr); }
    .detail-layout { grid-template-columns: 1fr; }
    .line-layout { grid-template-columns: 1fr; }
  }
</style>
</head>
<body>

<!-- SIDEBAR -->
<nav class="sidebar">
  <div class="sidebar-logo">
    <div class="logo-icon">âœ‚</div>
    <div>
      <div class="logo-text">SalonOS</div>
      <div class="logo-sub">ç¾å®¹å®¤ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </div>
    </div>
  </div>
  <div class="sidebar-nav">
    <a class="nav-item active" onclick="navigate('dashboard')" data-screen="dashboard">
      <span class="nav-icon">ğŸ“Š</span> ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
    </a>
    <a class="nav-item" onclick="navigate('appointments')" data-screen="appointments">
      <span class="nav-icon">ğŸ“…</span> äºˆç´„ç®¡ç†
    </a>
    <a class="nav-item" onclick="navigate('customers')" data-screen="customers">
      <span class="nav-icon">ğŸ‘¥</span> é¡§å®¢ã‚«ãƒ«ãƒ†
    </a>
    <a class="nav-item" onclick="navigate('line-send')" data-screen="line-send">
      <span class="nav-icon">ğŸ’¬</span> LINEé€ä¿¡
    </a>
  </div>
  <div class="sidebar-footer">
    <div class="staff-badge">
      <div class="staff-avatar">å±±</div>
      <div>
        <div class="staff-name">å±±ç”° ç¾ç©‚</div>
        <div class="staff-role">ã‚ªãƒ¼ãƒŠãƒ¼ã‚¹ã‚¿ã‚¤ãƒªã‚¹ãƒˆ</div>
      </div>
    </div>
  </div>
</nav>

<!-- MAIN -->
<main class="main">
  <div class="topbar">
    <div class="topbar-title" id="topbar-title">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</div>
    <div class="topbar-actions">
      <span class="topbar-date" id="topbar-date"></span>
      <button class="btn btn-primary btn-sm" onclick="openModal()">ï¼‹ æ–°è¦äºˆç´„</button>
    </div>
  </div>

  <div class="content">

    <!-- ===== SCREEN 1: DASHBOARD ===== -->
    <div class="screen active" id="screen-dashboard">
      <!-- KPI Cards -->
      <div class="kpi-grid" id="kpi-grid"></div>

      <div class="dashboard-grid">
        <!-- Today's Appointments -->
        <div class="card">
          <div class="card-header">
            <div class="card-title">ğŸ“‹ æœ¬æ—¥ã®äºˆç´„ <span id="today-count" class="badge badge-primary">0ä»¶</span></div>
            <button class="btn btn-secondary btn-sm" onclick="navigate('appointments')">å…¨ã¦è¦‹ã‚‹</button>
          </div>
          <div class="appt-list" id="today-appt-list"></div>
        </div>

        <!-- Alert -->
        <div class="card">
          <div class="card-header">
            <div class="card-title">âš ï¸ 3ãƒ¶æœˆä»¥ä¸Šæœªæ¥åº— <span id="alert-count" class="badge badge-danger">0å</span></div>
            <button class="btn btn-secondary btn-sm" onclick="navigate('line-send')">LINEé€ä¿¡</button>
          </div>
          <div class="alert-list" id="alert-list"></div>
        </div>

        <!-- Recent Karte -->
        <div class="card">
          <div class="card-header">
            <div class="card-title">ğŸ—‚ æœ€è¿‘è¿½åŠ ã—ãŸã‚«ãƒ«ãƒ†</div>
            <button class="btn btn-secondary btn-sm" onclick="navigate('customers')">å…¨ã¦è¦‹ã‚‹</button>
          </div>
          <div class="karte-mini-list" id="recent-karte-list"></div>
        </div>
      </div>
    </div>

    <!-- ===== SCREEN 2: APPOINTMENTS ===== -->
    <div class="screen" id="screen-appointments">
      <div class="calendar-nav">
        <button class="btn btn-secondary btn-sm" onclick="prevWeek()">â—€ å‰é€±</button>
        <h2 id="week-label"></h2>
        <button class="btn btn-secondary btn-sm" onclick="nextWeek()">æ¬¡é€± â–¶</button>
        <button class="btn btn-primary" onclick="openModal()">ï¼‹ æ–°è¦äºˆç´„è¿½åŠ </button>
      </div>
      <!-- Legend -->
      <div style="display:flex;gap:16px;margin-bottom:12px;font-size:12px;">
        <span style="display:flex;align-items:center;gap:5px;"><span style="width:10px;height:10px;border-radius:50%;background:var(--success);display:inline-block;"></span>ç¢ºå®š</span>
        <span style="display:flex;align-items:center;gap:5px;"><span style="width:10px;height:10px;border-radius:50%;background:var(--warning);display:inline-block;"></span>ä»®æŠ¼ã•ãˆ</span>
        <span style="display:flex;align-items:center;gap:5px;"><span style="width:10px;height:10px;border-radius:50%;background:var(--text-muted);display:inline-block;"></span>ã‚­ãƒ£ãƒ³ã‚»ãƒ«</span>
      </div>
      <div class="week-grid" id="week-grid"></div>
    </div>

    <!-- ===== SCREEN 3: CUSTOMERS ===== -->
    <div class="screen" id="screen-customers">
      <div class="search-bar">
        <input type="text" class="search-input" id="customer-search" placeholder="åå‰ãƒ»æ–½è¡“å†…å®¹ã§æ¤œç´¢..." oninput="filterCustomers(this.value)">
        <button class="btn btn-secondary">çµã‚Šè¾¼ã¿ â–¾</button>
        <span style="font-size:12px;color:var(--text-muted);" id="customer-count"></span>
      </div>
      <div class="customer-grid" id="customer-grid"></div>
    </div>

    <!-- ===== SCREEN 4: CUSTOMER DETAIL ===== -->
    <div class="screen" id="screen-customer-detail">
      <button class="btn btn-secondary btn-sm" onclick="navigate('customers')" style="margin-bottom:16px;">â† ã‚«ãƒ«ãƒ†ä¸€è¦§ã¸</button>
      <div class="detail-layout" id="detail-layout"></div>
    </div>

    <!-- ===== SCREEN 5: LINE SEND ===== -->
    <div class="screen" id="screen-line-send">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;">
        <div>
          <div style="font-size:16px;font-weight:700;">LINEä¸€æ–‰é€ä¿¡</div>
          <div style="font-size:12px;color:var(--text-muted);">3ãƒ¶æœˆä»¥ä¸Šæ¥åº—ã®ãªã„é¡§å®¢ã«æ¥åº—ä¿ƒé€²ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã—ã¾ã™</div>
        </div>
        <button class="btn btn-line" onclick="sendAll()">ğŸŸ¢ å…¨å“¡ã«é€ä¿¡</button>
      </div>
      <div class="line-layout">
        <div>
          <div class="section-title" style="margin-bottom:12px;">ğŸ“‹ é€ä¿¡å¯¾è±¡é¡§å®¢ <span id="line-target-count" class="badge badge-danger">0å</span></div>
          <div class="line-customer-list" id="line-customer-list"></div>
        </div>
        <div>
          <div class="section-title" style="margin-bottom:12px;">ğŸ‘ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</div>
          <div class="line-preview-box" id="line-preview-box">
            <div class="empty-state">
              <div class="icon">ğŸ’¬</div>
              <p>å·¦ã®ãƒªã‚¹ãƒˆã‹ã‚‰é¡§å®¢ã‚’é¸æŠã—ã¦ãã ã•ã„</p>
            </div>
          </div>
          <div style="margin-top:24px;">
            <div class="section-title" style="margin-bottom:12px;">ğŸ“¨ é€ä¿¡å±¥æ­´</div>
            <div class="card" style="padding:0;overflow:hidden;">
              <table class="history-table" id="history-table"></table>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div><!-- /content -->
</main>

<!-- MODAL: æ–°è¦äºˆç´„ -->
<div class="modal-overlay" id="modal-overlay" onclick="closeModalOutside(event)">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title">ğŸ“… æ–°è¦äºˆç´„è¿½åŠ </div>
      <button class="modal-close" onclick="closeModal()">âœ•</button>
    </div>
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">é¡§å®¢å</label>
        <select class="form-control" id="modal-customer">
          <option value="">é¡§å®¢ã‚’é¸æŠ...</option>
        </select>
      </div>
      <div class="form-group">
        <label class="form-label">æ‹…å½“ã‚¹ã‚¿ã‚¤ãƒªã‚¹ãƒˆ</label>
        <select class="form-control">
          <option>å±±ç”°</option>
          <option>éˆ´æœ¨</option>
          <option>ä½è—¤</option>
        </select>
      </div>
    </div>
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">æ—¥ä»˜</label>
        <input type="date" class="form-control" id="modal-date">
      </div>
      <div class="form-group">
        <label class="form-label">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</label>
        <select class="form-control">
          <option value="confirmed">ç¢ºå®š</option>
          <option value="tentative">ä»®æŠ¼ã•ãˆ</option>
        </select>
      </div>
    </div>
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">é–‹å§‹æ™‚é–“</label>
        <input type="time" class="form-control" value="10:00">
      </div>
      <div class="form-group">
        <label class="form-label">çµ‚äº†æ™‚é–“</label>
        <input type="time" class="form-control" value="11:30">
      </div>
    </div>
    <div class="form-group">
      <label class="form-label">æ–½è¡“ãƒ¡ãƒ‹ãƒ¥ãƒ¼</label>
      <input type="text" class="form-control" placeholder="ä¾‹: ã‚«ãƒƒãƒˆ + ã‚«ãƒ©ãƒ¼">
    </div>
    <div class="form-group">
      <label class="form-label">æ–™é‡‘ï¼ˆå††ï¼‰</label>
      <input type="number" class="form-control" placeholder="10000">
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="closeModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
      <button class="btn btn-primary" onclick="saveAppointment()">äºˆç´„ã‚’è¿½åŠ </button>
    </div>
  </div>
</div>

<script>
// =============================================================================
// DUMMY DATA
// =============================================================================
const DUMMY_DATA = {
  customers: [
    {
      id: 1,
      name: "ç”°ä¸­ å¥ˆç¾",
      furigana: "ãŸãªã‹ ãªã¿",
      phone: "090-3421-1234",
      email: "tanaka.nami@example.com",
      birthdate: "1986-03-15",
      allergies: "ãªã—",
      notes: "çŒ«ã£æ¯›ãƒ»ç´°ã‚ã€‚å‰é«ªã¯çŸ­ã‚ãŒå¥½ã¿ã€‚é ­çš®ãŒæ•æ„Ÿãªã®ã§ã‚¢ãƒ«ã‚«ãƒªã‚’æŠ‘ãˆãŸã‚«ãƒ©ãƒ¼æ¨å¥¨",
      createdAt: "2023-04-10",
      lineConnected: true,
      avatarColor: "#7C5CBF",
      visits: [
        {
          id: 1,
          date: "2025-11-08",
          menu: "ã‚«ãƒƒãƒˆ + ã‚«ãƒ©ãƒ¼ï¼ˆãƒ•ãƒ«ã‚«ãƒ©ãƒ¼ï¼‰",
          colorFormula: "ã€ROOTã€‘LEBEL ãƒãƒ†ãƒªã‚¢ N-8 / ã‚ªã‚­ã‚·6% 1:2 / æ”¾ç½®30åˆ†\nã€MID-ENDã€‘MILBON ã‚ªãƒ«ãƒ‡ã‚£ãƒ¼ãƒ– 8-SA + ã‚¯ãƒªã‚¢ 1:1 / ã‚ªã‚­ã‚·3% / æ”¾ç½®25åˆ†",
          staff: "å±±ç”°",
          price: 14500,
          notes: "æ ¹å…ƒ2cm ãƒªã‚¿ãƒƒãƒå¾Œã€æ¯›å…ˆã¯ã‚°ãƒ­ã‚¹ã‚«ãƒ©ãƒ¼ã§ãƒ„ãƒ¤å‡ºã—"
        },
        {
          id: 2,
          date: "2025-08-22",
          menu: "ã‚«ãƒƒãƒˆ + ã‚«ãƒ©ãƒ¼ï¼ˆãƒªã‚¿ãƒƒãƒï¼‰+ ãƒˆãƒªãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆ",
          colorFormula: "ã€ROOTã€‘LEBEL ãƒãƒ†ãƒªã‚¢ N-8 / ã‚ªã‚­ã‚·6% 1:2 / æ”¾ç½®30åˆ†\nã€TREATMENTã€‘KERASTASE ãƒ¬ã‚¸ã‚¹ã‚¿ãƒ³ã‚¹ ãƒã‚¹ã‚¯",
          staff: "å±±ç”°",
          price: 16800,
          notes: "ãƒˆãƒªãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆè¿½åŠ ã€‚ãƒ€ãƒ¡ãƒ¼ã‚¸ãŒå‡ºã¦ããŸãŸã‚æ¯›å…ˆã‚«ãƒƒãƒˆã‚‚2cm"
        },
        {
          id: 3,
          date: "2025-05-15",
          menu: "ã‚«ãƒƒãƒˆ + ãƒ˜ã‚¢ã‚»ãƒƒãƒˆï¼ˆçµå©šå¼ãŠå‘¼ã°ã‚Œï¼‰",
          colorFormula: "ï¼ˆã‚«ãƒ©ãƒ¼ãªã—ï¼‰",
          staff: "éˆ´æœ¨",
          price: 8500,
          notes: "ã‚¢ãƒƒãƒ—ã‚¹ã‚¿ã‚¤ãƒ«å¸Œæœ›ã€‚ãƒ‘ãƒ¼ãƒ«ç³»ãƒ”ãƒ³ã§ç•™ã‚ä»•ä¸Šã’"
        },
        {
          id: 4,
          date: "2025-02-10",
          menu: "ã‚«ãƒƒãƒˆ + ã‚«ãƒ©ãƒ¼ï¼ˆãƒ•ãƒ«ã‚«ãƒ©ãƒ¼ï¼‰",
          colorFormula: "MILBON ã‚ªãƒ«ãƒ‡ã‚£ãƒ¼ãƒ– 7-SA + 7-P / ã‚ªã‚­ã‚·6% 1:2 / æ”¾ç½®30åˆ†\nä»•ä¸ŠãŒã‚Šãƒˆãƒ¼ãƒ³: 7.5 ã‚¢ãƒƒã‚·ãƒ¥ãƒ‘ãƒ¼ãƒ—ãƒ«",
          staff: "å±±ç”°",
          price: 13200,
          notes: "åˆã‚ã¦ãƒ‘ãƒ¼ãƒ—ãƒ«ç³»ã‚’è©¦ã™ã€‚æœ¬äººå¸Œæœ›ã§å°‘ã—èµ¤ã¿æ®‹ã—"
        }
      ]
    },
    {
      id: 2,
      name: "ä½è—¤ æµé‡Œ",
      furigana: "ã•ã¨ã† ãˆã‚Š",
      phone: "080-7654-2345",
      email: "sato.eri@example.com",
      birthdate: "1991-07-28",
      allergies: "ã‚¸ã‚¢ãƒŸãƒ³ç³»ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ç–‘ã„ï¼ˆè¦ãƒ‘ãƒƒãƒãƒ†ã‚¹ãƒˆï¼‰",
      notes: "ãƒã‚¤ãƒ©ã‚¤ãƒˆå¥½ãã€‚æ˜ã‚‹ã„ä»•ä¸ŠãŒã‚Šã‚’å¥½ã‚€ã€‚ãƒ–ãƒªãƒ¼ãƒã¯é ­çš®ä»˜ã‘æ ¹1cmç©ºã‘ã¦æ–½è¡“",
      createdAt: "2022-09-05",
      lineConnected: true,
      avatarColor: "#E8A598",
      visits: [
        {
          id: 1,
          date: "2025-10-03",
          menu: "ãƒ–ãƒªãƒ¼ãƒ + ãƒã‚¤ãƒ©ã‚¤ãƒˆ + ãƒˆãƒ¼ãƒ‹ãƒ³ã‚°",
          colorFormula: "ã€ãƒ–ãƒªãƒ¼ãƒã€‘FIBRE BOOSTED BLEACH ãƒ‘ã‚¦ãƒ€ãƒ¼ / ã‚ªã‚­ã‚·6% 1:2 / ã‚¢ãƒ«ãƒŸå·»ã25æš / æ”¾ç½®35åˆ†\nã€TONERã€‘WELLA ã‚³ãƒ¬ã‚¹ãƒˆãƒ³ 10/38 + 10/0 / ã‚ªã‚­ã‚·1.9% / æ”¾ç½®20åˆ†",
          staff: "å±±ç”°",
          price: 24000,
          notes: "15ãƒ¬ãƒ™ãƒ«ã¾ã§è„±è‰²ã€‚ãƒˆãƒ¼ãƒ³ãƒ€ã‚¦ãƒ³æœ‰ã€‚æ—¢å­˜ãƒã‚¤ãƒ©ã‚¤ãƒˆã¨é¦´æŸ“ã‚€ã‚ˆã†èª¿æ•´"
        },
        {
          id: 2,
          date: "2025-06-18",
          menu: "ã‚«ãƒƒãƒˆ + ãƒã‚¤ãƒ©ã‚¤ãƒˆï¼ˆè£œä¿®ï¼‰",
          colorFormula: "ã€TONERè£œä¿®ã€‘WELLA ã‚³ãƒ¬ã‚¹ãƒˆãƒ³ 9/38 / ã‚ªã‚­ã‚·1.9% / æ”¾ç½®15åˆ†",
          staff: "å±±ç”°",
          price: 18500,
          notes: "é€€è‰²ãŒé€²ã¿ã‚ªãƒ¬ãƒ³ã‚¸å‘³ãŒå‡ºã¦ããŸãŸã‚ãƒˆãƒ¼ãƒŠãƒ¼ã®ã¿è£œä¿®"
        },
        {
          id: 3,
          date: "2025-02-22",
          menu: "ãƒ–ãƒªãƒ¼ãƒ + ãƒã‚¤ãƒ©ã‚¤ãƒˆï¼ˆæ–°è¦ï¼‰",
          colorFormula: "ã€ãƒ–ãƒªãƒ¼ãƒã€‘FIBRE BOOSTED BLEACH / ã‚ªã‚­ã‚·6% / æ”¾ç½®30åˆ†ï¼ˆã‚¢ãƒ«ãƒŸ20æšï¼‰\nã€TONERã€‘WELLA 10/38 / ã‚ªã‚­ã‚·1.9% / æ”¾ç½®20åˆ†",
          staff: "å±±ç”°",
          price: 22000,
          notes: "åˆãƒã‚¤ãƒ©ã‚¤ãƒˆã€‚é¢é•·ã®ãŸã‚é¡”å‘¨ã‚Šã«é›†ä¸­ã—ã¦ãƒ©ã‚¤ãƒ†ã‚£ãƒ³ã‚°"
        }
      ]
    },
    {
      id: 3,
      name: "å±±æœ¬ éº»å­",
      furigana: "ã‚„ã¾ã‚‚ã¨ ã‚ã•ã“",
      phone: "090-1122-3456",
      email: "yamamoto.asako@example.com",
      birthdate: "1979-11-03",
      allergies: "ãªã—",
      notes: "ãƒ‘ãƒ¼ãƒæ­´10å¹´ä»¥ä¸Šã€‚ãƒ­ãƒƒãƒ‰ã¯å¸¸ã«14mmä»¥ä¸Šã§æŸ”ã‚‰ã‹ã„ã‚¦ã‚§ãƒ¼ãƒ–ã‚’å¥½ã‚€ã€‚ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆã¯å¥½ã¾ãªã„",
      createdAt: "2021-06-20",
      lineConnected: false,
      avatarColor: "#4CAF8A",
      visits: [
        {
          id: 1,
          date: "2026-01-15",
          menu: "ãƒ‡ã‚¸ã‚¿ãƒ«ãƒ‘ãƒ¼ãƒ + ã‚«ãƒƒãƒˆ",
          colorFormula: "ã€ãƒ‘ãƒ¼ãƒæ¶²ã€‘SHISEIDO ãƒ—ãƒªãƒ¥ãƒãƒ« ã‚¯ãƒªãƒ¼ãƒ ã‚¦ã‚§ãƒ¼ãƒ–1æ¶²ï¼ˆè»ŸåŒ–å‰¤ï¼‰/ æ”¾ç½®15åˆ†\næ¸©åº¦ 130â„ƒ / ãƒ­ãƒƒãƒ‰16mmï¼ˆå…¨ä½“ï¼‰/ 2æ¶²ã‚ªã‚­ã‚·3% æ”¾ç½®10åˆ†",
          staff: "å±±ç”°",
          price: 19000,
          notes: "å‰å›ã‚ˆã‚Š1ã‚µã‚¤ã‚ºå¤§ãã„ãƒ­ãƒƒãƒ‰ã§ç·©ã‚ã‚¦ã‚§ãƒ¼ãƒ–ã«å¤‰æ›´ã€‚æœ¬äººå¤§æº€è¶³"
        },
        {
          id: 2,
          date: "2025-09-10",
          menu: "ãƒ‡ã‚¸ã‚¿ãƒ«ãƒ‘ãƒ¼ãƒ + ã‚«ãƒƒãƒˆ + ã‚«ãƒ©ãƒ¼ï¼ˆã‚°ãƒ¬ã‚¤ã‚«ãƒãƒ¼ï¼‰",
          colorFormula: "ã€ãƒ‘ãƒ¼ãƒã€‘å…ˆã«ãƒ‘ãƒ¼ãƒæ–½è¡“\nã€ã‚«ãƒ©ãƒ¼ã€‘LEBEL ãƒãƒ†ãƒªã‚¢ G-6 + G-8 / ã‚ªã‚­ã‚·3% / æ”¾ç½®25åˆ†ï¼ˆç™½é«ª30%ï¼‰",
          staff: "å±±ç”°",
          price: 23500,
          notes: "ç™½é«ªã‚«ãƒãƒ¼å¸Œæœ›ã€‚ã‚°ãƒ¬ã‚¤ã‚«ãƒ©ãƒ¼ã§è‡ªç„¶ãªã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³"
        },
        {
          id: 3,
          date: "2025-04-20",
          menu: "ã‚«ãƒƒãƒˆ + ã‚«ãƒ©ãƒ¼ï¼ˆã‚°ãƒ¬ã‚¤ã‚«ãƒãƒ¼ï¼‰",
          colorFormula: "LEBEL ãƒãƒ†ãƒªã‚¢ G-5 / ã‚ªã‚­ã‚·6% / æ”¾ç½®35åˆ†ï¼ˆç™½é«ª35%ï¼‰",
          staff: "éˆ´æœ¨",
          price: 11000,
          notes: "ãƒ‘ãƒ¼ãƒã‚’ãŠä¼‘ã¿ã—ã¦ã‚«ãƒ©ãƒ¼ã®ã¿ã€‚æ¬¡å›ã¯ãƒ‘ãƒ¼ãƒäºˆå®š"
        },
        {
          id: 4,
          date: "2024-11-08",
          menu: "ãƒ‡ã‚¸ã‚¿ãƒ«ãƒ‘ãƒ¼ãƒ + ã‚«ãƒƒãƒˆ",
          colorFormula: "ã€ãƒ‘ãƒ¼ãƒæ¶²ã€‘ãƒ—ãƒªãƒ¥ãƒãƒ« 1æ¶² / æ”¾ç½®15åˆ† / æ¸©åº¦ 130â„ƒ / ãƒ­ãƒƒãƒ‰14mm",
          staff: "å±±ç”°",
          price: 17500,
          notes: "æ¯›é‡å¤šã‚ã®ãŸã‚å†…å´ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ã‚«ãƒƒãƒˆã‚’é‡ç‚¹çš„ã«"
        }
      ]
    },
    {
      id: 4,
      name: "éˆ´æœ¨ å‹ç¾",
      furigana: "ã™ãšã ã¨ã‚‚ã¿",
      phone: "070-9876-4567",
      email: "suzuki.tomomi@example.com",
      birthdate: "1998-04-22",
      allergies: "ãªã—",
      notes: "Zä¸–ä»£ã€‚ã‚¤ãƒ³ã‚¹ã‚¿ã§è¦‹ãŸéŸ“å›½é¢¨ã‚¹ã‚¿ã‚¤ãƒ«ãŒå¥½ã¿ã€‚ã‚±ã‚¢ãƒ–ãƒªãƒ¼ãƒå¯¾å¿œå¯ã€‚æ¬¡å›Wã‚«ãƒ©ãƒ¼å¸Œæœ›",
      createdAt: "2024-01-18",
      lineConnected: true,
      avatarColor: "#F0A500",
      visits: [
        {
          id: 1,
          date: "2025-12-05",
          menu: "ã‚±ã‚¢ãƒ–ãƒªãƒ¼ãƒ + ã‚¤ãƒ³ãƒŠãƒ¼ã‚«ãƒ©ãƒ¼ï¼ˆãƒ”ãƒ³ã‚¯ãƒ™ãƒ¼ã‚¸ãƒ¥ï¼‰",
          colorFormula: "ã€ãƒ–ãƒªãƒ¼ãƒã€‘FIBRE BOOSTED BLEACH + OLAPLEX No.1 / ã‚ªã‚­ã‚·6% / æ”¾ç½®25åˆ†\nã€ã‚¤ãƒ³ãƒŠãƒ¼ã€‘MILBON ã‚ªãƒ«ãƒ‡ã‚£ãƒ¼ãƒ– ã‚¢ãƒ‡ã‚£ã‚¯ã‚·ãƒ¼ Amethyst + ãƒ”ãƒ³ã‚¯ / ã‚ªã‚­ã‚·1.9% / æ”¾ç½®20åˆ†\nä»•ä¸ŠãŒã‚Š: å†…å´17ãƒ¬ãƒ™ãƒ«ãƒ»å¤–å´9ãƒ¬ãƒ™ãƒ«",
          staff: "å±±ç”°",
          price: 28000,
          notes: "è€³ä¸Š10cmãŒã‚¤ãƒ³ãƒŠãƒ¼ã‚¾ãƒ¼ãƒ³ã€‚é¡”ã¾ã‚ã‚Šç”£æ¯›ã¯éš›ã‹ã‚‰0.5cmæ®‹ã™"
        },
        {
          id: 2,
          date: "2025-08-14",
          menu: "ã‚±ã‚¢ãƒ–ãƒªãƒ¼ãƒ + ãƒã‚¤ãƒ©ã‚¤ãƒˆ + ã‚«ãƒƒãƒˆ",
          colorFormula: "ã€ãƒ–ãƒªãƒ¼ãƒã€‘FIBRE BOOSTED BLEACH / ã‚ªã‚­ã‚·6% / ã‚¹ãƒ©ã‚¤ã‚¹15æš\nã€TONERã€‘MILBON ã‚¢ãƒ‡ã‚£ã‚¯ã‚·ãƒ¼ ã‚¹ãƒ¢ãƒ¼ã‚­ãƒ¼ãƒˆãƒ‘ãƒ¼ã‚º / ã‚ªã‚­ã‚·1.9% / æ”¾ç½®15åˆ†",
          staff: "å±±ç”°",
          price: 26500,
          notes: "éŸ“å›½ãƒãƒ‹ãƒ¼ãƒ“ãƒ¼ã‚«ãƒ©ãƒ¼å‚è€ƒã€‚ãƒŠãƒãƒ¥ãƒ©ãƒ«ãƒã‚¤ãƒ©ã‚¤ãƒˆã§æŠœã‘æ„Ÿã‚’æ¼”å‡º"
        },
        {
          id: 3,
          date: "2025-04-08",
          menu: "ã‚«ãƒ©ãƒ¼ï¼ˆåˆæ¥åº—ãƒ»å…¨ä½“ï¼‰",
          colorFormula: "MILBON ã‚¢ãƒ‡ã‚£ã‚¯ã‚·ãƒ¼ ã‚¹ãƒ¢ãƒ¼ã‚­ãƒ¼ãƒˆãƒ‘ãƒ¼ã‚º 9 / ã‚ªã‚­ã‚·6% 1:2 / æ”¾ç½®25åˆ†",
          staff: "å±±ç”°",
          price: 11500,
          notes: "åˆæ¥åº—ã€‚å…¨ä½“çš„ã«ã‚¢ãƒƒã‚·ãƒ¥ç³»å¸Œæœ›ã€‚ãƒ–ãƒªãƒ¼ãƒãªã—ã§9ãƒˆãƒ¼ãƒ³é”æˆ"
        }
      ]
    },
    {
      id: 5,
      name: "é«˜æ©‹ åƒæµå­",
      furigana: "ãŸã‹ã¯ã— ã¡ãˆã“",
      phone: "090-2233-5678",
      email: "takahashi.chieko@example.com",
      birthdate: "1962-09-30",
      allergies: "ãªã—",
      notes: "60ä»£ã€‚ç™½é«ªãŒç›®ç«‹ã¡ã‚„ã™ã„ãŸã‚ãƒªã‚¿ãƒƒãƒã¯6ã€œ7é€±ã§æ¨å¥¨ã€‚ãƒ–ãƒ­ãƒ¼ã®ã¿ä»•ä¸Šã’ã‚’å¥½ã‚€",
      createdAt: "2020-03-15",
      lineConnected: false,
      avatarColor: "#9B7DD4",
      visits: [
        {
          id: 1,
          date: "2025-10-20",
          menu: "ã‚«ãƒƒãƒˆ + ã‚°ãƒ¬ã‚¤ã‚«ãƒ©ãƒ¼ï¼ˆå…¨ä½“ï¼‰",
          colorFormula: "LEBEL ãƒãƒ†ãƒªã‚¢ G-4 + OBe-4 (7:3) / ã‚ªã‚­ã‚·6% 1:2 / æ”¾ç½®35åˆ†\nç™½é«ª: å…¨ä½“ç´„50% / ä»•ä¸ŠãŒã‚Š: ãƒŠãƒãƒ¥ãƒ©ãƒ«ãƒ–ãƒ©ã‚¦ãƒ³",
          staff: "å±±ç”°",
          price: 13500,
          notes: "ç™½é«ªæ¯”ç‡ãŒå¢—åŠ å‚¾å‘ã€‚æ˜ã‚‹ã„G4ã§è‡ªç„¶ãªã‚°ãƒ¬ã‚¤ãƒ–ãƒ¬ãƒ³ãƒ‰ã«"
        },
        {
          id: 2,
          date: "2025-08-05",
          menu: "ã‚«ãƒƒãƒˆ + ã‚°ãƒ¬ã‚¤ã‚«ãƒ©ãƒ¼ï¼ˆãƒªã‚¿ãƒƒãƒï¼‰",
          colorFormula: "LEBEL ãƒãƒ†ãƒªã‚¢ G-4 / ã‚ªã‚­ã‚·6% 1:2 / æ”¾ç½®35åˆ†ï¼ˆæ ¹å…ƒ2cmï¼‰",
          staff: "å±±ç”°",
          price: 11000,
          notes: "ãƒªã‚¿ãƒƒãƒã®ã¿ã€‚ç™½é«ª3ã€œ4cmä¼¸ã³ã¦ã„ã‚‹"
        },
        {
          id: 3,
          date: "2025-06-10",
          menu: "ã‚«ãƒƒãƒˆ + ã‚°ãƒ¬ã‚¤ã‚«ãƒ©ãƒ¼ï¼ˆå…¨ä½“ï¼‰",
          colorFormula: "LEBEL ãƒãƒ†ãƒªã‚¢ G-4 + G-6 (5:5) / ã‚ªã‚­ã‚·3% / æ”¾ç½®35åˆ†",
          staff: "å±±ç”°",
          price: 13500,
          notes: "æ˜ã‚‹ã‚ã«ä»•ä¸Šã’ãŸã„å¸Œæœ›ã€‚ã‚ªã‚­ã‚·3%ã§åˆºæ¿€è»½æ¸›"
        },
        {
          id: 4,
          date: "2025-03-28",
          menu: "ã‚«ãƒƒãƒˆ + ã‚°ãƒ¬ã‚¤ã‚«ãƒ©ãƒ¼ï¼ˆãƒªã‚¿ãƒƒãƒï¼‰",
          colorFormula: "LEBEL ãƒãƒ†ãƒªã‚¢ G-4 / ã‚ªã‚­ã‚·6% 1:2 / æ”¾ç½®35åˆ†ï¼ˆæ ¹å…ƒ2.5cmï¼‰",
          staff: "éˆ´æœ¨",
          price: 11000,
          notes: "å‰å›ã‹ã‚‰8é€±çµŒéã€‚ç™½é«ªç›®ç«‹ã¡ã‚„ã™ã„ãŸã‚æ¬¡å›ã¯6é€±å¾Œæ¨å¥¨"
        },
        {
          id: 5,
          date: "2025-01-15",
          menu: "ã‚«ãƒƒãƒˆ + ã‚°ãƒ¬ã‚¤ã‚«ãƒ©ãƒ¼ï¼ˆå…¨ä½“ï¼‰+ ãƒˆãƒªãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆ",
          colorFormula: "LEBEL ãƒãƒ†ãƒªã‚¢ G-4 + OBe-4 / ã‚ªã‚­ã‚·6% / æ”¾ç½®35åˆ†\nã€TREATMENTã€‘LEBEL IAU ã‚¨ãƒƒã‚»ãƒ³ã‚¹",
          staff: "å±±ç”°",
          price: 15200,
          notes: "å¹´å§‹ã‚ã§ãƒ•ãƒ«ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã€‚æ¯›å…ˆã®ãƒ‘ã‚µã¤ããŒæ°—ã«ãªã‚‹ã¨ã®ã“ã¨"
        }
      ]
    },
    {
      id: 6,
      name: "ä¼Šè—¤ ç¾å’²",
      furigana: "ã„ã¨ã† ã¿ã•ã",
      phone: "080-5544-6789",
      email: "ito.misaki@example.com",
      birthdate: "1995-01-14",
      allergies: "ãªã—",
      notes: "è‚©ä¸Šãƒœãƒ–ãŒå®šç€ã‚¹ã‚¿ã‚¤ãƒ«ã€‚ã‚«ãƒ©ãƒ¼ã¯ãƒ¬ãƒƒãƒ‰ç³»çµ±ã‚’ç¶™ç¶šä¸­ã€‚è·å ´NGã®ãŸã‚æ´¾æ‰‹ã™ããªã„ã‚ˆã†æ³¨æ„",
      createdAt: "2023-07-22",
      lineConnected: true,
      avatarColor: "#E05252",
      visits: [
        {
          id: 1,
          date: "2025-11-28",
          menu: "ã‚«ãƒƒãƒˆ + ã‚«ãƒ©ãƒ¼ï¼ˆãƒ­ãƒ¼ãƒ©ã‚¤ãƒˆå…¥ã‚Šï¼‰",
          colorFormula: "ã€BASEã€‘MILBON ã‚ªãƒ«ãƒ‡ã‚£ãƒ¼ãƒ– 6-R / ã‚ªã‚­ã‚·6% 1:2 / æ”¾ç½®30åˆ†\nã€ãƒ­ãƒ¼ãƒ©ã‚¤ãƒˆã€‘ã‚ªãƒ«ãƒ‡ã‚£ãƒ¼ãƒ– 4-R / ã‚¢ãƒ«ãƒŸå·»ã8æš / æ”¾ç½®30åˆ†\nä»•ä¸ŠãŒã‚Š: æš—ã‚èµ¤è¤è‰² / 6ã€œ4ãƒˆãƒ¼ãƒ³",
          staff: "å±±ç”°",
          price: 17500,
          notes: "å°±æ´»ã‚·ãƒ¼ã‚ºãƒ³çµ‚äº†ã§ãƒ­ãƒ¼ãƒ©ã‚¤ãƒˆè¿½åŠ ã€‚ç«‹ä½“æ„ŸãŒå‡ºã¦å¤§æº€è¶³"
        },
        {
          id: 2,
          date: "2025-08-30",
          menu: "ã‚«ãƒƒãƒˆ + ã‚«ãƒ©ãƒ¼ï¼ˆãƒ•ãƒ«ã‚«ãƒ©ãƒ¼ï¼‰",
          colorFormula: "MILBON ã‚ªãƒ«ãƒ‡ã‚£ãƒ¼ãƒ– 7-R + RR/ ã‚ªã‚­ã‚·6% 1:2 / æ”¾ç½®30åˆ†\nä»•ä¸ŠãŒã‚Š: èµ¤ã¿ãƒ–ãƒ©ã‚¦ãƒ³ 7ãƒˆãƒ¼ãƒ³",
          staff: "å±±ç”°",
          price: 14000,
          notes: "å¤ã ãŒè·å ´ã®è¦å®šã‚’è€ƒæ…®ã—ã¦ãƒ¬ãƒƒãƒ‰ãƒ–ãƒ©ã‚¦ãƒ³ã«ç•™ã‚ã‚‹"
        },
        {
          id: 3,
          date: "2025-05-16",
          menu: "ã‚«ãƒƒãƒˆ + ã‚«ãƒ©ãƒ¼ï¼ˆãƒªã‚¿ãƒƒãƒï¼‰",
          colorFormula: "MILBON ã‚ªãƒ«ãƒ‡ã‚£ãƒ¼ãƒ– 6-R / ã‚ªã‚­ã‚·6% / æ ¹å…ƒ2cm ãƒªã‚¿ãƒƒãƒã®ã¿ / æ”¾ç½®30åˆ†",
          staff: "å±±ç”°",
          price: 12500,
          notes: "ãƒªã‚¿ãƒƒãƒã®ã¿ã€‚ã‚«ãƒƒãƒˆã¯2cmã‚«ãƒ¼ãƒ«ã—ãŸã ã‘"
        },
        {
          id: 4,
          date: "2025-02-08",
          menu: "ã‚«ãƒƒãƒˆ + ã‚«ãƒ©ãƒ¼ï¼ˆãƒ•ãƒ«ã‚«ãƒ©ãƒ¼ï¼‰",
          colorFormula: "MILBON ã‚ªãƒ«ãƒ‡ã‚£ãƒ¼ãƒ– 6-R / ã‚ªã‚­ã‚·6% 1:2 / æ”¾ç½®30åˆ†",
          staff: "å±±ç”°",
          price: 14000,
          notes: "ãƒãƒ¬ãƒ³ã‚¿ã‚¤ãƒ³å‰ã®æ°—åˆ†è»¢æ›ã€‚ã‚­ãƒ£ãƒ©ãƒ¡ãƒ«ãƒ¬ãƒƒãƒ‰ã§è¯ã‚„ã‹ã•ã‚’æ¼”å‡º"
        }
      ]
    },
    {
      id: 7,
      name: "æ¸¡è¾º ã•ãã‚‰",
      furigana: "ã‚ãŸãªã¹ ã•ãã‚‰",
      phone: "090-8877-7890",
      email: "watanabe.sakura@example.com",
      birthdate: "2001-03-18",
      allergies: "ãªã—",
      notes: "å¤§å­¦ç”Ÿã€‚ãƒã‚¤ãƒˆã®é–¢ä¿‚ã§ãƒŠãƒãƒ¥ãƒ©ãƒ«ç³»ä¸­å¿ƒã€‚ã‚«ãƒƒãƒˆã¯ãŠã¾ã‹ã›ã‚¹ã‚¿ã‚¤ãƒ«OKã€‚ãƒŸãƒ«ã‚¯ãƒ†ã‚£ãƒ¼ç³»ãƒ™ãƒ¼ã‚¸ãƒ¥ãŒå¥½ã¿",
      createdAt: "2024-06-14",
      lineConnected: true,
      avatarColor: "#4A90D9",
      visits: [
        {
          id: 1,
          date: "2025-09-20",
          menu: "ã‚«ãƒƒãƒˆ + ã‚«ãƒ©ãƒ¼ï¼ˆãƒ•ãƒ«ã‚«ãƒ©ãƒ¼ï¼‰",
          colorFormula: "MILBON ã‚ªãƒ«ãƒ‡ã‚£ãƒ¼ãƒ– ã‚¢ãƒ‡ã‚£ã‚¯ã‚·ãƒ¼ ã‚¹ãƒ¢ãƒ¼ã‚­ãƒ¼ãƒˆãƒ‘ãƒ¼ã‚º 9 + ãƒ™ãƒ¼ã‚¸ãƒ¥ 10 (6:4) / ã‚ªã‚­ã‚·6% / æ”¾ç½®25åˆ†\nä»•ä¸ŠãŒã‚Š: 9.5ãƒˆãƒ¼ãƒ³ ãƒŸãƒ«ã‚¯ãƒ†ã‚£ãƒ¼ãƒ™ãƒ¼ã‚¸ãƒ¥",
          staff: "å±±ç”°",
          price: 13500,
          notes: "å¤æ˜ã‘ã§å°‘ã—é€€è‰²ã—ãŸæ¯›å…ˆã‚’æ•´ãˆã€‚ãƒ™ãƒ¼ã‚¸ãƒ¥æ„Ÿã‚’å¼·èª¿"
        },
        {
          id: 2,
          date: "2025-06-05",
          menu: "ã‚«ãƒƒãƒˆ + ã‚«ãƒ©ãƒ¼ï¼ˆæ–°è¦ï¼‰",
          colorFormula: "MILBON ã‚¢ãƒ‡ã‚£ã‚¯ã‚·ãƒ¼ ã‚¹ãƒ¢ãƒ¼ã‚­ãƒ¼ãƒˆãƒ‘ãƒ¼ã‚º 9 / ã‚ªã‚­ã‚·6% / æ”¾ç½®25åˆ†",
          staff: "å±±ç”°",
          price: 12500,
          notes: "åˆæ¥åº—ã€‚å‰ã®ã‚µãƒ­ãƒ³ã§ã‚ªãƒ¬ãƒ³ã‚¸ã£ã½ã‹ã£ãŸå±¥æ­´ã‚ã‚Šã€‚ã‚¢ãƒƒã‚·ãƒ¥ã§èµ¤ã¿æ¶ˆã—"
        }
      ]
    },
    {
      id: 8,
      name: "ä¸­æ‘ æ¢¨èŠ±",
      furigana: "ãªã‹ã‚€ã‚‰ ã‚Šã‹",
      phone: "080-6655-8901",
      email: "nakamura.rika@example.com",
      birthdate: "1988-12-05",
      allergies: "ãƒ‘ãƒ©ãƒ™ãƒ³å«æœ‰è£½å“ã§ã‹ã¶ã‚Œæ­´ã‚ã‚Š",
      notes: "ç”£å¾Œãƒ˜ã‚¢ã‚±ã‚¢ã«æ³¨åŠ›ã€‚ã‚¹ã‚­ãƒ£ãƒ«ãƒ—ã‚±ã‚¢å¿…é ˆã€‚æˆä¹³ä¸­ã®ãŸã‚åˆºæ¿€ã®å°‘ãªã„è–¬å‰¤ã‚’é¸å®šã€‚ã‚«ãƒƒãƒˆã®ã¿ã®æ¥åº—ã‚‚å¤šã„",
      createdAt: "2022-11-30",
      lineConnected: true,
      avatarColor: "#6BAE8A",
      visits: [
        {
          id: 1,
          date: "2025-10-10",
          menu: "ã‚«ãƒƒãƒˆ + ã‚¹ã‚­ãƒ£ãƒ«ãƒ—ãƒˆãƒªãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆ",
          colorFormula: "ï¼ˆã‚«ãƒ©ãƒ¼ãªã—ï¼‰\nã€SCALPã€‘LEBEL ã‚¹ã‚­ãƒ£ãƒ«ãƒ— ã‚¨ãƒƒã‚»ãƒ³ã‚¹ / ãƒãƒƒã‚µãƒ¼ã‚¸15åˆ†",
          staff: "å±±ç”°",
          price: 9500,
          notes: "ç”£å¾Œã®æŠœã‘æ¯›ç›¸è«‡ã‚ã‚Šã€‚ã‚¹ã‚­ãƒ£ãƒ«ãƒ—é‡ç‚¹çš„ã«æ–½è¡“"
        },
        {
          id: 2,
          date: "2025-07-18",
          menu: "ã‚«ãƒƒãƒˆ + å¼±é…¸æ€§ç¸®æ¯›çŸ¯æ­£",
          colorFormula: "ã€ç¸®æ¯›ã€‘MILBON ãƒªã‚·ã‚ª ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆSæ¶²ï¼ˆå¼±é…¸æ€§ï¼‰ / æ”¾ç½®20åˆ† / ã‚¢ã‚¤ãƒ­ãƒ³180â„ƒ\n2æ¶²: ãƒ–ãƒ­ãƒ é…¸ / æ”¾ç½®10åˆ†",
          staff: "å±±ç”°",
          price: 22000,
          notes: "ç”£å¾Œã®ã†ã­ã‚Šãƒ»ãã›æ¯›ãŒå¼·ããªã£ãŸãŸã‚åˆç¸®æ¯›çŸ¯æ­£ã€‚å‰å¾Œã«é ­çš®ã‚±ã‚¢"
        },
        {
          id: 3,
          date: "2025-03-25",
          menu: "ã‚«ãƒƒãƒˆ + ã‚¹ã‚­ãƒ£ãƒ«ãƒ—ãƒˆãƒªãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆ",
          colorFormula: "ï¼ˆã‚«ãƒ©ãƒ¼ãªã—ï¼‰",
          staff: "éˆ´æœ¨",
          price: 8000,
          notes: "æˆä¹³ä¸­ã®ãŸã‚ã‚«ãƒ©ãƒ¼ãªã—ã€‚ã‚¹ã‚­ãƒ£ãƒ«ãƒ—ã‚±ã‚¢ã®ã¿"
        },
        {
          id: 4,
          date: "2024-12-20",
          menu: "ã‚«ãƒƒãƒˆ + ã‚«ãƒ©ãƒ¼ï¼ˆä½åˆºæ¿€ï¼‰",
          colorFormula: "THROWï¼ˆã‚¸ãƒ£ã‚¹ãƒˆé…¸åŒ–æŸ“æ–™ï¼‰ãƒ©ã‚¤ãƒˆã‚¢ãƒƒã‚·ãƒ¥ / ã‚ªã‚­ã‚·3% / æ”¾ç½®20åˆ†\nãƒ‘ãƒ©ãƒ™ãƒ³ãƒ•ãƒªãƒ¼è–¬å‰¤ä½¿ç”¨",
          staff: "å±±ç”°",
          price: 12000,
          notes: "æˆä¹³å’æ¥­å¾Œåˆã‚«ãƒ©ãƒ¼ã€‚ãƒ‘ãƒ©ãƒ™ãƒ³ãƒ•ãƒªãƒ¼ã®ã‚¹ãƒ­ã‚¦ç³»è–¬å‰¤ã§åˆºæ¿€è»½æ¸›"
        },
        {
          id: 5,
          date: "2024-09-05",
          menu: "ã‚«ãƒƒãƒˆã®ã¿",
          colorFormula: "ï¼ˆæ–½è¡“ãªã—ï¼‰",
          staff: "å±±ç”°",
          price: 5500,
          notes: "ç”£å¾Œåˆæ¥åº—ã€‚ä½“èª¿ç¢ºèªã—ãªãŒã‚‰çŸ­æ™‚é–“ã§çµ‚äº†"
        }
      ]
    }
  ],

  appointments: [
    {
      id: 1,
      customerId: 3,
      date: "2026-02-16",
      startTime: "10:00",
      endTime: "12:30",
      menu: "ãƒ‡ã‚¸ã‚¿ãƒ«ãƒ‘ãƒ¼ãƒ + ã‚«ãƒƒãƒˆ",
      status: "confirmed",
      staff: "å±±ç”°",
      price: 19000
    },
    {
      id: 2,
      customerId: 5,
      date: "2026-02-16",
      startTime: "14:00",
      endTime: "15:30",
      menu: "ã‚°ãƒ¬ã‚¤ã‚«ãƒ©ãƒ¼ï¼ˆãƒªã‚¿ãƒƒãƒï¼‰",
      status: "confirmed",
      staff: "éˆ´æœ¨",
      price: 11000
    },
    {
      id: 3,
      customerId: 1,
      date: "2026-02-17",
      startTime: "11:00",
      endTime: "13:00",
      menu: "ã‚«ãƒƒãƒˆ + ã‚«ãƒ©ãƒ¼ï¼ˆãƒ•ãƒ«ã‚«ãƒ©ãƒ¼ï¼‰",
      status: "confirmed",
      staff: "å±±ç”°",
      price: 14500
    },
    {
      id: 4,
      customerId: 7,
      date: "2026-02-17",
      startTime: "15:00",
      endTime: "16:30",
      menu: "ã‚«ãƒƒãƒˆ + ã‚«ãƒ©ãƒ¼",
      status: "tentative",
      staff: "å±±ç”°",
      price: 13500
    },
    {
      id: 5,
      customerId: 4,
      date: "2026-02-18",
      startTime: "10:00",
      endTime: "13:00",
      menu: "ã‚±ã‚¢ãƒ–ãƒªãƒ¼ãƒ + ã‚¤ãƒ³ãƒŠãƒ¼ã‚«ãƒ©ãƒ¼",
      status: "confirmed",
      staff: "å±±ç”°",
      price: 28000
    },
    {
      id: 6,
      customerId: 6,
      date: "2026-02-18",
      startTime: "14:30",
      endTime: "16:00",
      menu: "ã‚«ãƒƒãƒˆ + ã‚«ãƒ©ãƒ¼ï¼ˆãƒ­ãƒ¼ãƒ©ã‚¤ãƒˆï¼‰",
      status: "confirmed",
      staff: "å±±ç”°",
      price: 17500
    },
    {
      id: 7,
      customerId: 8,
      date: "2026-02-19",
      startTime: "10:00",
      endTime: "11:30",
      menu: "ã‚«ãƒƒãƒˆ + ã‚¹ã‚­ãƒ£ãƒ«ãƒ—ãƒˆãƒªãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆ",
      status: "confirmed",
      staff: "éˆ´æœ¨",
      price: 9500
    },
    {
      id: 8,
      customerId: 2,
      date: "2026-02-19",
      startTime: "13:00",
      endTime: "16:00",
      menu: "ãƒ–ãƒªãƒ¼ãƒ + ãƒã‚¤ãƒ©ã‚¤ãƒˆ + ãƒˆãƒ¼ãƒ‹ãƒ³ã‚°",
      status: "tentative",
      staff: "å±±ç”°",
      price: 24000
    },
    {
      id: 9,
      customerId: 5,
      date: "2026-02-20",
      startTime: "09:30",
      endTime: "11:00",
      menu: "ã‚«ãƒƒãƒˆ + ã‚°ãƒ¬ã‚¤ã‚«ãƒ©ãƒ¼",
      status: "cancelled",
      staff: "å±±ç”°",
      price: 13500
    },
    {
      id: 10,
      customerId: 1,
      date: "2026-02-21",
      startTime: "11:00",
      endTime: "13:30",
      menu: "ã‚«ãƒƒãƒˆ + ã‚«ãƒ©ãƒ¼ + ãƒˆãƒªãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆ",
      status: "tentative",
      staff: "å±±ç”°",
      price: 16800
    }
  ],

  lineHistory: [
    {
      id: 1,
      customerId: 7,
      sentAt: "2026-02-10 14:30",
      message: "æ¸¡è¾ºã•ã‚“ã€ã“ã‚“ã«ã¡ã¯ï¼å‰å›ã®ã‚«ãƒ©ãƒ¼ã‹ã‚‰ç´„5ãƒ¶æœˆãŒçµŒã¡ã¾ã—ãŸã€‚ãŠå…ƒæ°—ã§ã—ã‚‡ã†ã‹ï¼Ÿãã‚ãã‚ã‚«ãƒ©ãƒ¼ã®ãƒªã‚¿ãƒƒãƒã‚„ã‚¹ã‚¿ã‚¤ãƒ«ãƒã‚§ãƒ³ã‚¸ã¯ã„ã‹ãŒã§ã—ã‚‡ã†ã‹ï¼Ÿãœã²ã¾ãŸãŠå¾…ã¡ã—ã¦ãŠã‚Šã¾ã™âœ‚",
      status: "delivered"
    },
    {
      id: 2,
      customerId: 2,
      sentAt: "2026-01-25 10:15",
      message: "ä½è—¤ã•ã‚“ã€ã“ã‚“ã«ã¡ã¯ï¼å‰å›ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆã‹ã‚‰3ãƒ¶æœˆä»¥ä¸ŠãŒçµŒã¡ã¾ã—ãŸã€‚ãã‚ãã‚æ ¹å…ƒã‚‚æ°—ã«ãªã£ã¦ã„ã¾ã›ã‚“ã‹ï¼Ÿã”äºˆç´„ã¯ã„ã¤ã§ã‚‚LINEã§ãŠæ°—è»½ã«ã©ã†ãï¼",
      status: "delivered"
    },
    {
      id: 3,
      customerId: 7,
      sentAt: "2025-12-20 16:00",
      message: "æ¸¡è¾ºã•ã‚“ã€å¹´æœ«ã®ã‚¹ã‚¿ã‚¤ãƒ«ãƒã‚§ãƒ³ã‚¸ã¯ã„ã‹ãŒã§ã™ã‹ï¼ŸãŠå¾—ãªå¹´æœ«ã‚«ãƒ©ãƒ¼ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ã‚’å®Ÿæ–½ä¸­ã§ã™ã€‚ãœã²ã”æ¥åº—ãŠå¾…ã¡ã—ã¦ãŠã‚Šã¾ã™ï¼",
      status: "delivered"
    },
    {
      id: 4,
      customerId: 8,
      sentAt: "2025-12-05 11:00",
      message: "ä¸­æ‘ã•ã‚“ã€ã“ã‚“ã«ã¡ã¯ï¼ã‚¹ã‚­ãƒ£ãƒ«ãƒ—ã‚±ã‚¢ã®ã”çŠ¶æ³ã¯ã„ã‹ãŒã§ã—ã‚‡ã†ã‹ï¼Ÿç”£å¾Œã®æŠœã‘æ¯›ã‚±ã‚¢ã«åŠ¹æœçš„ãªãƒˆãƒªãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã‚‚ã”ç”¨æ„ã—ã¦ã„ã¾ã™ã€‚ãœã²ã”ç›¸è«‡ãã ã•ã„ï¼",
      status: "failed"
    },
    {
      id: 5,
      customerId: 6,
      sentAt: "2025-11-01 13:45",
      message: "ä¼Šè—¤ã•ã‚“ã€ã“ã‚“ã«ã¡ã¯ï¼å‰å›ã®ã‚«ãƒ©ãƒ¼ã‹ã‚‰3ãƒ¶æœˆãŒçµŒã¡ã¾ã—ãŸã€‚ãã‚ãã‚ãƒªã‚¿ãƒƒãƒã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã™âœ¨ ã”éƒ½åˆã®è‰¯ã„æ—¥æ™‚ã‚’ãŠçŸ¥ã‚‰ã›ãã ã•ã„ï¼",
      status: "delivered"
    }
  ]
};

// =============================================================================
// APP STATE
// =============================================================================
let currentScreen = 'dashboard';
let currentCustomerId = null;
let selectedLineCustomer = null;
let calendarWeekOffset = 0;
let sentCustomers = new Set();

// =============================================================================
// UTILITIES
// =============================================================================
function getToday() {
  return new Date(2026, 1, 18); // 2026-02-18 (fixed demo date)
}

function formatDate(dateStr) {
  const d = new Date(dateStr + 'T00:00:00');
  return d.toLocaleDateString('ja-JP', { year: 'numeric', month: 'long', day: 'numeric' });
}

function formatDateShort(dateStr) {
  const d = new Date(dateStr + 'T00:00:00');
  return `${d.getMonth() + 1}/${d.getDate()}`;
}

function daysSince(dateStr) {
  const d = new Date(dateStr + 'T00:00:00');
  const today = getToday();
  return Math.floor((today - d) / (1000 * 60 * 60 * 24));
}

function getLastVisit(customer) {
  if (!customer.visits || customer.visits.length === 0) return null;
  return customer.visits.reduce((a, b) => a.date > b.date ? a : b);
}

function isOverdue(customer) {
  const last = getLastVisit(customer);
  if (!last) return true;
  return daysSince(last.date) >= 90;
}

function getOverdueCustomers() {
  return DUMMY_DATA.customers.filter(c => isOverdue(c));
}

function addDays(date, n) {
  const d = new Date(date);
  d.setDate(d.getDate() + n);
  return d;
}

function dateToStr(date) {
  const y = date.getFullYear();
  const m = String(date.getMonth() + 1).padStart(2, '0');
  const d = String(date.getDate()).padStart(2, '0');
  return `${y}-${m}-${d}`;
}

function getWeekDates(offset) {
  const today = getToday();
  const dayOfWeek = today.getDay(); // 0=Sun
  const monday = addDays(today, -dayOfWeek + 1 + offset * 7);
  const days = [];
  for (let i = 0; i < 7; i++) {
    days.push(addDays(monday, i));
  }
  return days;
}

function getAvatarBg(customer) {
  return customer.avatarColor || '#7C5CBF';
}

function getInitials(name) {
  return name.replace(/\s/g, '').charAt(0);
}

function getMenuTags(customer) {
  const menus = new Set();
  (customer.visits || []).forEach(v => {
    if (v.menu.includes('ã‚«ãƒ©ãƒ¼') || v.menu.includes('ãƒã‚¤ãƒ©ã‚¤ãƒˆ') || v.menu.includes('ãƒ–ãƒªãƒ¼ãƒ')) menus.add('ã‚«ãƒ©ãƒ¼');
    if (v.menu.includes('ã‚«ãƒƒãƒˆ')) menus.add('ã‚«ãƒƒãƒˆ');
    if (v.menu.includes('ãƒ‘ãƒ¼ãƒ')) menus.add('ãƒ‘ãƒ¼ãƒ');
    if (v.menu.includes('ãƒˆãƒªãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆ') || v.menu.includes('ã‚¹ã‚­ãƒ£ãƒ«ãƒ—')) menus.add('ã‚±ã‚¢');
    if (v.menu.includes('ç¸®æ¯›')) menus.add('ç¸®æ¯›çŸ¯æ­£');
    if (v.menu.includes('ãƒ˜ã‚¢ã‚»ãƒƒãƒˆ')) menus.add('ã‚»ãƒƒãƒˆ');
  });
  return [...menus];
}

function getCustomerById(id) {
  return DUMMY_DATA.customers.find(c => c.id === id);
}

function addNextVisitDate(lastDate) {
  const d = new Date(lastDate + 'T00:00:00');
  d.setMonth(d.getMonth() + 3);
  return dateToStr(d);
}

function generateMessage(customer) {
  const last = getLastVisit(customer);
  const dayCount = last ? daysSince(last.date) : 0;
  const months = Math.floor(dayCount / 30);
  const menuShort = last ? last.menu.split('ï¼ˆ')[0].split('+')[0].trim() : 'ã”æ¥åº—';
  return `${customer.name.split(' ')[0]}ã•ã‚“ã€ã“ã‚“ã«ã¡ã¯ï¼SalonOSã‚ˆã‚Šã”é€£çµ¡ã§ã™ã€‚\n\nå‰å›ã®${menuShort}ã‹ã‚‰ç´„${months}ãƒ¶æœˆãŒçµŒã¡ã¾ã—ãŸã€‚ãã‚ãã‚æ°—ã«ãªã£ã¦ãã¦ã„ã¾ã›ã‚“ã‹ï¼Ÿ\n\nã„ã¤ã§ã‚‚LINEã§ã”äºˆç´„ãƒ»ã”ç›¸è«‡ã‚’ãŠå¾…ã¡ã—ã¦ãŠã‚Šã¾ã™âœ‚\n\nã”äºˆç´„ã¯ã“ã¡ã‚‰â–¶ https://salon-os.example.com/booking`;
}

// =============================================================================
// NAVIGATION
// =============================================================================
function navigate(screen, customerId) {
  currentScreen = screen;

  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));

  const screenId = screen === 'customer-detail' ? 'screen-customer-detail' : `screen-${screen}`;
  const el = document.getElementById(screenId);
  if (el) el.classList.add('active');

  const navScreen = screen === 'customer-detail' ? 'customers' : screen;
  document.querySelector(`[data-screen="${navScreen}"]`)?.classList.add('active');

  const titles = {
    dashboard: 'ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰',
    appointments: 'äºˆç´„ç®¡ç†',
    customers: 'é¡§å®¢ã‚«ãƒ«ãƒ†ä¸€è¦§',
    'customer-detail': 'é¡§å®¢ã‚«ãƒ«ãƒ†è©³ç´°',
    'line-send': 'LINEé€ä¿¡ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼'
  };
  document.getElementById('topbar-title').textContent = titles[screen] || '';

  if (screen === 'customer-detail' && customerId) {
    currentCustomerId = customerId;
    renderCustomerDetail(customerId);
  } else if (screen === 'appointments') {
    renderCalendar();
  } else if (screen === 'line-send') {
    renderLineSend();
  } else if (screen === 'customers') {
    filterCustomers('');
  }

  window.scrollTo(0, 0);
}

// =============================================================================
// RENDER: DASHBOARD
// =============================================================================
function renderDashboard() {
  // Date
  const today = getToday();
  document.getElementById('topbar-date').textContent =
    today.toLocaleDateString('ja-JP', { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' });

  // KPI
  const kpiGrid = document.getElementById('kpi-grid');
  const kpis = [
    { label: 'æœˆæ¬¡å£²ä¸Š', value: 'Â¥', num: '842,000', unit: '', change: '+12%', up: true, cls: 'purple', icon: 'ğŸ’´' },
    { label: 'æ–°è¦é¡§å®¢æ•°', value: '', num: '8', unit: 'å', change: '+3å', up: true, cls: 'green', icon: 'ğŸŒ±' },
    { label: 'ãƒªãƒ”ãƒ¼ãƒˆç‡', value: '', num: '87', unit: '%', change: '+2pt', up: true, cls: 'orange', icon: 'ğŸ”„' },
    { label: 'LINEé€ä¿¡æ•°', value: '', num: '23', unit: 'ä»¶', change: 'å…ˆæœˆæ¯” +5ä»¶', up: true, cls: 'pink', icon: 'ğŸ’¬' },
  ];
  kpiGrid.innerHTML = kpis.map(k => `
    <div class="kpi-card ${k.cls}">
      <div class="kpi-icon">${k.icon}</div>
      <div class="kpi-label">${k.label}</div>
      <div class="kpi-value">${k.value}${k.num}<span class="kpi-unit">${k.unit}</span></div>
      <div class="kpi-change up">â†‘ ${k.change} (å‰æœˆæ¯”)</div>
    </div>
  `).join('');

  // Today's appointments
  const todayStr = '2026-02-18';
  const todayAppts = DUMMY_DATA.appointments.filter(a => a.date === todayStr)
    .sort((a, b) => a.startTime.localeCompare(b.startTime));
  document.getElementById('today-count').textContent = todayAppts.length + 'ä»¶';
  const apptList = document.getElementById('today-appt-list');
  if (todayAppts.length === 0) {
    apptList.innerHTML = '<div class="empty-state"><div class="icon">ğŸ“­</div><p>æœ¬æ—¥ã®äºˆç´„ã¯ã‚ã‚Šã¾ã›ã‚“</p></div>';
  } else {
    apptList.innerHTML = todayAppts.map(a => {
      const c = getCustomerById(a.customerId);
      const statusLabel = { confirmed: 'ç¢ºå®š', tentative: 'ä»®æŠ¼ã•ãˆ', cancelled: 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«' }[a.status];
      return `
        <div class="appt-item" onclick="navigate('customer-detail', ${a.customerId})">
          <div class="appt-time">${a.startTime}</div>
          <div class="appt-bar bar-${a.status}"></div>
          <div class="appt-info">
            <div class="appt-name">${c ? c.name : 'ä¸æ˜'}</div>
            <div class="appt-menu">${a.menu} / ${a.staff}</div>
          </div>
          <div class="appt-price">Â¥${a.price.toLocaleString()}</div>
          <div class="status-dot dot-${a.status}"></div>
        </div>
      `;
    }).join('');
  }

  // Alert list
  const overdue = getOverdueCustomers();
  document.getElementById('alert-count').textContent = overdue.length + 'å';
  const alertList = document.getElementById('alert-list');
  alertList.innerHTML = overdue.map(c => {
    const last = getLastVisit(c);
    const days = last ? daysSince(last.date) : 999;
    return `
      <div class="alert-item" onclick="navigate('customer-detail', ${c.id})" style="cursor:pointer;">
        <div class="avatar" style="background:${getAvatarBg(c)};width:28px;height:28px;font-size:11px;">${getInitials(c.name)}</div>
        <div class="name">${c.name}</div>
        <div class="days">${days}æ—¥æœªæ¥åº—</div>
        <button class="btn btn-line btn-sm" onclick="event.stopPropagation();navigate('line-send')">LINE</button>
      </div>
    `;
  }).join('');

  // Recent karte
  const sorted = [...DUMMY_DATA.customers].sort((a, b) => b.createdAt.localeCompare(a.createdAt));
  const recent = sorted.slice(0, 4);
  const karteList = document.getElementById('recent-karte-list');
  karteList.innerHTML = recent.map(c => {
    const last = getLastVisit(c);
    return `
      <div class="karte-mini" onclick="navigate('customer-detail', ${c.id})">
        <div class="avatar" style="background:${getAvatarBg(c)}">${getInitials(c.name)}</div>
        <div class="info">
          <div class="name">${c.name}</div>
          <div class="sub">${last ? last.menu.split('ï¼ˆ')[0] : 'æ¥åº—å±¥æ­´ãªã—'}</div>
        </div>
        <div class="meta">
          <div class="date">${last ? formatDateShort(last.date) : '-'}</div>
          <div style="font-size:10px;color:var(--text-muted);">æœ€çµ‚æ¥åº—</div>
        </div>
      </div>
    `;
  }).join('');
}

// =============================================================================
// RENDER: CALENDAR
// =============================================================================
const HOURS = ['09:00','10:00','11:00','12:00','13:00','14:00','15:00','16:00','17:00','18:00'];
const DOW = ['æœˆ','ç«','æ°´','æœ¨','é‡‘','åœŸ','æ—¥'];
const DOW_FULL = ['æœˆæ›œæ—¥','ç«æ›œæ—¥','æ°´æ›œæ—¥','æœ¨æ›œæ—¥','é‡‘æ›œæ—¥','åœŸæ›œæ—¥','æ—¥æ›œæ—¥'];

function prevWeek() { calendarWeekOffset--; renderCalendar(); }
function nextWeek() { calendarWeekOffset++; renderCalendar(); }

function renderCalendar() {
  const weekDates = getWeekDates(calendarWeekOffset);
  const todayStr = dateToStr(getToday());

  // Header
  const startStr = `${weekDates[0].getMonth()+1}æœˆ${weekDates[0].getDate()}æ—¥`;
  const endStr = `${weekDates[6].getMonth()+1}æœˆ${weekDates[6].getDate()}æ—¥`;
  document.getElementById('week-label').textContent =
    `${weekDates[0].getFullYear()}å¹´ ${startStr} ã€œ ${endStr}`;

  const grid = document.getElementById('week-grid');
  let html = '';

  // Header row
  html += `<div class="time-col-header"></div>`;
  weekDates.forEach((d, i) => {
    const ds = dateToStr(d);
    const isToday = ds === todayStr;
    const domHtml = isToday
      ? `<div class="dom" style="background:var(--primary);color:white;width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;margin:0 auto;">${d.getDate()}</div>`
      : `<div class="dom" style="font-size:16px;color:var(--primary);">${d.getDate()}</div>`;
    html += `<div class="week-header-cell${isToday?' today':''}">
      <div class="dow">${DOW[i]}</div>
      ${domHtml}
    </div>`;
  });

  // Time rows
  HOURS.forEach((hour, hi) => {
    html += `<div class="time-label">${hour}</div>`;
    weekDates.forEach((d, di) => {
      const ds = dateToStr(d);
      // Find appointments in this cell (per-hour)
      const appts = DUMMY_DATA.appointments.filter(a => {
        if (a.date !== ds) return false;
        const aHour = parseInt(a.startTime.split(':')[0]);
        const cellHour = parseInt(hour.split(':')[0]);
        return aHour === cellHour;
      });

      let cellContent = '';
      appts.forEach(a => {
        const c = getCustomerById(a.customerId);
        const startMin = parseInt(a.startTime.split(':')[1]);
        const endH = parseInt(a.endTime.split(':')[0]);
        const endM = parseInt(a.endTime.split(':')[1]);
        const startH = parseInt(a.startTime.split(':')[0]);
        const durationHours = (endH * 60 + endM - startH * 60 - startMin) / 60;
        const topPx = (startMin / 60) * 48;
        const heightPx = Math.max(durationHours * 48 - 2, 30);
        cellContent += `
          <div class="cal-event ${a.status}"
               style="top:${topPx}px;height:${heightPx}px;"
               onclick="navigate('customer-detail', ${a.customerId})"
               title="${c ? c.name : ''} / ${a.menu}">
            <div class="ev-name">${c ? c.name.split(' ')[0] : '?'}</div>
            <div class="ev-menu">${a.menu.split('ï¼ˆ')[0]}</div>
          </div>
        `;
      });

      html += `<div class="time-cell" data-date="${ds}" data-hour="${hour}">${cellContent}</div>`;
    });
  });

  grid.innerHTML = html;
}

// =============================================================================
// RENDER: CUSTOMERS
// =============================================================================
function renderCustomerGrid(customers) {
  const grid = document.getElementById('customer-grid');
  document.getElementById('customer-count').textContent = `${customers.length}å`;

  if (customers.length === 0) {
    grid.innerHTML = '<div class="empty-state" style="grid-column:1/-1"><div class="icon">ğŸ”</div><p>è©²å½“ã™ã‚‹é¡§å®¢ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</p></div>';
    return;
  }

  grid.innerHTML = customers.map(c => {
    const last = getLastVisit(c);
    const overdue = isOverdue(c);
    const tags = getMenuTags(c);
    const days = last ? daysSince(last.date) : 999;

    return `
      <div class="customer-card" onclick="navigate('customer-detail', ${c.id})">
        ${overdue ? '<div class="overdue-badge">è¦ãƒ•ã‚©ãƒ­ãƒ¼</div>' : ''}
        <div class="customer-card-header">
          <div class="avatar" style="background:${getAvatarBg(c)};width:44px;height:44px;font-size:17px;">${getInitials(c.name)}</div>
          <div>
            <div class="name">${c.name}</div>
            <div class="furigana">${c.furigana}</div>
            ${c.lineConnected ? '<div class="line-badge" style="margin-top:3px;">ğŸŸ¢ LINEé€£æºæ¸ˆ</div>' : ''}
          </div>
        </div>
        <div class="last-visit">
          æœ€çµ‚æ¥åº—: ${last ? formatDate(last.date) : 'æ¥åº—ãªã—'}
          ${overdue ? `<span style="color:var(--danger);font-size:11px;font-weight:700;margin-left:6px;">(${days}æ—¥å‰)</span>` : ''}
        </div>
        <div class="visit-count">
          <span>ğŸ“Œ ${c.visits.length}å›æ¥åº—</span>
        </div>
        <div class="service-icons">
          ${tags.map(t => `<span class="service-tag">${t}</span>`).join('')}
        </div>
      </div>
    `;
  }).join('');
}

function filterCustomers(query) {
  const q = query.toLowerCase();
  const filtered = DUMMY_DATA.customers.filter(c => {
    if (!q) return true;
    if (c.name.toLowerCase().includes(q) || c.furigana.includes(q)) return true;
    const tags = getMenuTags(c);
    if (tags.some(t => t.toLowerCase().includes(q))) return true;
    if (c.visits.some(v => v.menu.toLowerCase().includes(q))) return true;
    return false;
  });
  renderCustomerGrid(filtered);
}

// =============================================================================
// RENDER: CUSTOMER DETAIL
// =============================================================================
function renderCustomerDetail(customerId) {
  const c = getCustomerById(customerId);
  if (!c) return;

  const last = getLastVisit(c);
  const nextVisit = last ? addNextVisitDate(last.date) : null;
  const overdue = isOverdue(c);

  const layout = document.getElementById('detail-layout');

  // Profile column
  const profileHTML = `
    <div>
      <div class="profile-card">
        <div class="profile-avatar-lg" style="background:${getAvatarBg(c)}">${getInitials(c.name)}</div>
        <div class="profile-name">${c.name}</div>
        <div class="profile-furigana">${c.furigana}</div>
        ${overdue ? '<div style="text-align:center;margin-bottom:10px;"><span class="badge badge-danger">âš  3ãƒ¶æœˆä»¥ä¸Šæœªæ¥åº—</span></div>' : ''}
        ${c.lineConnected ? '<div style="text-align:center;margin-bottom:14px;"><span class="line-badge">ğŸŸ¢ LINEé€£æºæ¸ˆ</span></div>' : '<div style="text-align:center;margin-bottom:14px;"><span class="badge badge-muted">LINEæœªé€£æº</span></div>'}
        <div class="profile-actions">
          ${c.lineConnected ? `<button class="btn btn-line btn-sm" onclick="openLinePreview(${c.id})">ğŸ’¬ LINEé€ä¿¡</button>` : '<button class="btn btn-secondary btn-sm" disabled>LINEæœªé€£æº</button>'}
          <button class="btn btn-secondary btn-sm" onclick="openModal()">ï¼‹ äºˆç´„è¿½åŠ </button>
        </div>
        <table class="profile-info-table">
          <tr><th>é›»è©±</th><td>${c.phone}</td></tr>
          <tr><th>ãƒ¡ãƒ¼ãƒ«</th><td style="font-size:11px;">${c.email}</td></tr>
          <tr><th>èª•ç”Ÿæ—¥</th><td>${c.birthdate.replace(/-/g, '/')}</td></tr>
          <tr><th>ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼</th><td style="color:${c.allergies !== 'ãªã—' ? 'var(--danger)' : 'inherit'};font-weight:${c.allergies !== 'ãªã—' ? '700' : '400'};">${c.allergies}</td></tr>
          <tr><th>æ¥åº—å›æ•°</th><td><strong>${c.visits.length}å›</strong></td></tr>
          <tr><th>ç™»éŒ²æ—¥</th><td>${c.createdAt.replace(/-/g, '/')}</td></tr>
        </table>
        <div style="margin-top:14px;padding:12px;background:var(--bg);border-radius:8px;font-size:12px;color:var(--text-secondary);line-height:1.6;">
          <div style="font-size:10px;font-weight:700;color:var(--text-muted);margin-bottom:4px;">å‚™è€ƒãƒ»ã‚¹ã‚¿ã‚¤ãƒªã‚¹ãƒˆãƒ¡ãƒ¢</div>
          ${c.notes}
        </div>
        ${nextVisit ? `
        <div class="next-visit-box" style="margin-top:14px;">
          <div class="label">æ¬¡å›æ¥åº—æ¨å¥¨æ—¥</div>
          <div class="date">${formatDate(nextVisit)}</div>
          <div class="sub">å‰å›æ¥åº—ã‹ã‚‰3ãƒ¶æœˆå¾Œ</div>
        </div>
        ` : ''}
      </div>
    </div>
  `;

  // Timeline column
  const sortedVisits = [...c.visits].sort((a, b) => b.date.localeCompare(a.date));
  const timelineHTML = `
    <div>
      <div class="card">
        <div class="card-header">
          <div class="card-title">ğŸ“‹ æ–½è¡“å±¥æ­´ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ï¼ˆ${sortedVisits.length}ä»¶ï¼‰</div>
        </div>
        <div class="timeline">
          ${sortedVisits.map((v, i) => `
            <div class="timeline-item">
              <div class="timeline-card">
                <div class="tl-header">
                  <div class="tl-date">${formatDate(v.date)} / æ‹…å½“: ${v.staff}</div>
                  <div class="tl-price">Â¥${v.price.toLocaleString()}</div>
                </div>
                <div class="tl-menu">${v.menu}</div>
                ${v.colorFormula && v.colorFormula !== 'ï¼ˆæ–½è¡“ãªã—ï¼‰' ? `
                <div class="tl-formula">${v.colorFormula.replace(/\n/g, '<br>')}</div>
                ` : ''}
                ${v.notes ? `<div class="tl-footer">ğŸ“ ${v.notes}</div>` : ''}
              </div>
            </div>
          `).join('')}
        </div>
      </div>
    </div>
  `;

  layout.innerHTML = profileHTML + timelineHTML;
}

function openLinePreview(customerId) {
  navigate('line-send');
  setTimeout(() => {
    selectLineCustomer(customerId);
  }, 100);
}

// =============================================================================
// RENDER: LINE SEND
// =============================================================================
function renderLineSend() {
  const overdue = getOverdueCustomers();
  document.getElementById('line-target-count').textContent = overdue.length + 'å';

  // Customer list
  const list = document.getElementById('line-customer-list');
  list.innerHTML = overdue.map(c => {
    const last = getLastVisit(c);
    const days = last ? daysSince(last.date) : 999;
    const isSent = sentCustomers.has(c.id);
    return `
      <div class="line-customer-item ${selectedLineCustomer === c.id ? 'selected' : ''}"
           id="line-item-${c.id}"
           onclick="selectLineCustomer(${c.id})">
        <div class="avatar" style="background:${getAvatarBg(c)};width:36px;height:36px;font-size:14px;">${getInitials(c.name)}</div>
        <div class="info">
          <div class="name">${c.name}</div>
          <div class="sub">${days}æ—¥æœªæ¥åº— / ${c.lineConnected ? 'ğŸŸ¢ LINEé€£æº' : 'âŒ LINEæœªé€£æº'}</div>
        </div>
        ${isSent ? '<span class="badge badge-success">é€ä¿¡æ¸ˆ</span>' : ''}
        ${!c.lineConnected ? '<span class="badge badge-muted">æœªé€£æº</span>' : ''}
      </div>
    `;
  }).join('');

  // History
  renderLineHistory();
}

function selectLineCustomer(customerId) {
  selectedLineCustomer = customerId;
  const c = getCustomerById(customerId);
  if (!c) return;

  // Update selection highlight
  document.querySelectorAll('.line-customer-item').forEach(el => el.classList.remove('selected'));
  const itemEl = document.getElementById(`line-item-${customerId}`);
  if (itemEl) itemEl.classList.add('selected');

  const msg = generateMessage(c);
  const previewBox = document.getElementById('line-preview-box');
  const alreadySent = sentCustomers.has(customerId);

  previewBox.innerHTML = `
    <div class="section-title" style="margin-bottom:12px;">
      ${c.name} ã¸ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
    </div>
    <div class="line-phone-mock">
      <div class="line-phone-header">SalonOS å…¬å¼LINE</div>
      <div style="display:flex;align-items:flex-start;gap:8px;">
        <div style="width:32px;height:32px;background:#00C300;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:14px;flex-shrink:0;">âœ‚</div>
        <div>
          <div class="line-sender-name">SalonOS Beauty</div>
          <div class="line-chat-bubble">${msg.replace(/\n/g, '<br>')}</div>
        </div>
      </div>
      <div style="text-align:right;margin-top:6px;color:rgba(255,255,255,.4);font-size:10px;">
        ${alreadySent ? 'æ—¢èª­ 1' : 'æœªé€ä¿¡'}
      </div>
    </div>
    <div class="send-btn-wrap">
      <div class="send-success ${alreadySent ? 'show' : ''}" id="send-success-${customerId}">
        <div class="checkmark">âœ…</div>
        <div class="msg">é€ä¿¡å®Œäº†ã—ã¾ã—ãŸï¼</div>
      </div>
      ${!alreadySent ? `
      <button class="btn btn-line" onclick="sendMessage(${customerId})" ${!c.lineConnected ? 'disabled title="LINEæœªé€£æº"' : ''}>
        ${c.lineConnected ? 'ğŸŸ¢ ã“ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡' : 'âŒ LINEæœªé€£æºã®ãŸã‚é€ä¿¡ä¸å¯'}
      </button>
      ` : `<button class="btn btn-secondary" disabled>é€ä¿¡æ¸ˆã¿</button>`}
    </div>
  `;
}

function sendMessage(customerId) {
  const c = getCustomerById(customerId);
  if (!c || !c.lineConnected) return;

  sentCustomers.add(customerId);

  const successEl = document.getElementById(`send-success-${customerId}`);
  if (successEl) {
    successEl.classList.add('show');
  }

  // Add to history
  const newEntry = {
    id: DUMMY_DATA.lineHistory.length + 1,
    customerId: customerId,
    sentAt: new Date().toLocaleString('ja-JP').replace(/\//g, '-'),
    message: generateMessage(c),
    status: 'delivered'
  };
  DUMMY_DATA.lineHistory.unshift(newEntry);
  renderLineHistory();

  // Refresh customer item
  setTimeout(() => renderLineSend(), 500);
}

function sendAll() {
  const overdue = getOverdueCustomers().filter(c => c.lineConnected);
  overdue.forEach(c => {
    if (!sentCustomers.has(c.id)) {
      sentCustomers.add(c.id);
      const newEntry = {
        id: DUMMY_DATA.lineHistory.length + 1,
        customerId: c.id,
        sentAt: new Date().toLocaleString('ja-JP'),
        message: generateMessage(c),
        status: 'delivered'
      };
      DUMMY_DATA.lineHistory.unshift(newEntry);
    }
  });
  renderLineSend();
  if (selectedLineCustomer) {
    setTimeout(() => selectLineCustomer(selectedLineCustomer), 100);
  }
}

function renderLineHistory() {
  const table = document.getElementById('history-table');
  const history = DUMMY_DATA.lineHistory.slice(0, 8);
  const statusLabel = { delivered: 'é…ä¿¡æ¸ˆ', failed: 'å¤±æ•—', pending: 'é€ä¿¡ä¸­' };
  const statusPill = { delivered: 'pill-delivered', failed: 'pill-failed', pending: 'pill-pending' };

  table.innerHTML = `
    <thead>
      <tr>
        <th>é€ä¿¡æ—¥æ™‚</th>
        <th>é¡§å®¢å</th>
        <th>ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆæŠœç²‹ï¼‰</th>
        <th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
      </tr>
    </thead>
    <tbody>
      ${history.map(h => {
        const c = getCustomerById(h.customerId);
        return `
          <tr>
            <td style="white-space:nowrap;">${h.sentAt}</td>
            <td>${c ? c.name : 'ä¸æ˜'}</td>
            <td style="max-width:200px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">${h.message}</td>
            <td><span class="status-pill ${statusPill[h.status]}">${statusLabel[h.status]}</span></td>
          </tr>
        `;
      }).join('')}
    </tbody>
  `;
}

// =============================================================================
// MODAL
// =============================================================================
function openModal() {
  document.getElementById('modal-overlay').classList.add('open');
  // Fill customer select
  const sel = document.getElementById('modal-customer');
  sel.innerHTML = '<option value="">é¡§å®¢ã‚’é¸æŠ...</option>' +
    DUMMY_DATA.customers.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
  // Default date
  document.getElementById('modal-date').value = '2026-02-18';
}
function closeModal() {
  document.getElementById('modal-overlay').classList.remove('open');
}
function closeModalOutside(e) {
  if (e.target.id === 'modal-overlay') closeModal();
}
function saveAppointment() {
  closeModal();
  alert('äºˆç´„ã‚’è¿½åŠ ã—ã¾ã—ãŸï¼ï¼ˆãƒ‡ãƒ¢: ãƒ‡ãƒ¼ã‚¿ã¯ä¿å­˜ã•ã‚Œã¾ã›ã‚“ï¼‰');
}

// =============================================================================
// INIT
// =============================================================================
document.addEventListener('DOMContentLoaded', () => {
  renderDashboard();
  renderCustomerGrid(DUMMY_DATA.customers);
  // Set today date in topbar
  const today = getToday();
  document.getElementById('topbar-date').textContent =
    today.toLocaleDateString('ja-JP', { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' });
});
</script>
</body>
</html>
